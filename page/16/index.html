<!doctype html>
<html class="theme-next ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="h7BaHlqi6VjlciSt0RF-KHgIXZcGfx3L3gyQ9qfx_ek" />










  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="wuxu, Golang, C, CPP, CS, PHP, " />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="Wu Xu的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Wu Xu">
<meta property="og:url" content="http://blog.wuxu92.com/page/16/index.html">
<meta property="og:site_name" content="Wu Xu">
<meta property="og:description" content="Wu Xu的个人博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wu Xu">
<meta name="twitter:description" content="Wu Xu的个人博客">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'hide',
    motion: false
  };
</script>

  <title> Wu Xu </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-72131273-1', 'auto');
  ga('send', 'pageview');
</script>





  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>
    <div class="bottomband"></div> <!-- add by wuxu -->
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Wu Xu</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">关注C、Go、C++、JavaScript和UX</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/remove-last-letter-of-each-line/" itemprop="url">
                  使用后期静态绑定实现MVC的Model的基类
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-08-11T12:34:50+08:00" content="2015-08-11">
              2015-08-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/framework/" itemprop="url" rel="index">
                    <span itemprop="name">framework</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>一直拖着没写，估计不会写了</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/php-variable-implementation/" itemprop="url">
                  PHP变量在内核中的实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-08-10T12:34:50+08:00" content="2015-08-10">
              2015-08-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>PHP本身是一种弱类型的语言，可以在程序中改变变量存储的值的类型。那么这些变量在PHP的底层是如何实现的呢，理解内核变中变量的实现机制将有利于我们理解PHP的变量系统。</p>
<h2 id="变量的类型"><a href="#变量的类型" class="headerlink" title="变量的类型"></a>变量的类型</h2><p>对PHP有一定理解的同学应该都已经知道了PHP在内核中是使用zval这个结构体来存储变量的，也就是说不同的变量在底层都是一个zval结构体，它定义在Zend/zend.h中：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">struct _zval_struct &#123;</span><br><span class="line">    zvalue_value value; /* 变量的值 */</span><br><span class="line">    zend_uint refcount__gc;</span><br><span class="line">    zend_uchar type;    /* 变量当前的数据类型 */</span><br><span class="line">    zend_uchar is_ref__gc;</span><br><span class="line">&#125;;</span><br><span class="line">typedef struct _zval_struct zval;</span><br><span class="line"></span><br><span class="line">//在Zend/zend_types.h里定义的：</span><br><span class="line">typedef unsigned int zend_uint;</span><br><span class="line">typedef unsigned char zend_uchar;</span><br></pre></td></tr></table></figure>
<p>其中保存变量的值的value则是zvalue_value类型，它是一个union：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">typedef union _zvalue_value &#123;</span><br><span class="line">    long lval;  /* long value */</span><br><span class="line">    double dval;    /* double value */</span><br><span class="line">    struct &#123;</span><br><span class="line">        char *val;</span><br><span class="line">        int len;</span><br><span class="line">    &#125; str;</span><br><span class="line">    HashTable *ht;  /* hash table value */</span><br><span class="line">    zend_object_value obj;</span><br><span class="line">&#125; zvalue_value;</span><br></pre></td></tr></table></figure>
<p>PHP使用zvalue_value实现8种数据类型，这些类型在内核中分别对应特定的常量。通过这个union可以理解常用的类型判断函数： <code>is_null, is_bool, is_long, is_double, is_string, is_array, is_object, is_resource</code> 他们的效率应该是很高的。同时也可以猜想gettype函数的实现大概使用了Z_TYPE_P宏，这个宏大概和zval结构的type有关<br>在Zend/zend_operators.h中定义的宏：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#define Z_TYPE(zval)        (zval).type</span><br><span class="line">#define Z_TYPE_P(zval_p)    Z_TYPE(*zval_p)</span><br><span class="line">#define Z_TYPE_PP(zval_pp)  Z_TYPE(**zval_pp)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意，虽然在32位系统中，signed long的存储范围是-2147483648～2147483647 的整数，但是要注意，如果整数变量超出了这个范围并不会直接溢出，而是会转换程double类型继续计算。</p>
</blockquote>
<p>PHP内核还同时在zval结构里保存着字符串的实际长度， 这个设计使PHP可以在字符串中嵌入‘\0’字符，也使PHP的字符串是二进制安全的， 可以安全的存储二进制数据</p>
<h2 id="变量的值"><a href="#变量的值" class="headerlink" title="变量的值"></a>变量的值</h2><p>string型变量比较特殊，因为内核在保存String型变量时，不仅保存了字符串的值，还保存了它的长度， 所以它有对应的两种宏组合STRVAL和STRLEN，即：Z_STRVAL、Z_STRVAL_P、Z_STRVAL_PP与Z_STRLEN、Z_STRLEN_P、Z_STRLEN_PP。 前一种宏返回的是char *型，即字符串的地址；后一种返回的是int型，即字符串的长度。</p>
<p>Array型变量的值其实是存储在C语言实现的HashTable中的， 我们可以用ARRVAL组合宏（Z_ARRVAL, Z_ARRVAL_P, Z_ARRVAL_PP）这三个宏来访问数组的值。</p>
<p>对象是一个复杂的结构体（zend_object_value结构体），不仅存储属性的定义、属性的值，还存储着访问权限、方法等信息。 内核中定义了以下组合宏让我们方便的操作对象： OBJ_HANDLE：返回handle标识符， OBJ_HT：handle表， OBJCE：类定义， OBJPROP：HashTable的属性， OBJ_HANDLER：在OBJ_HT中操作一个特殊的handler方法。</p>
<p>资源型变量的值其实就是一个整数，可以用RESVAL组合宏来访问它，我们把它的值传给zend_fetch_resource函数，便可以得到这个资源的操作句柄，如mysql的链接句柄等。</p>
<h2 id="创建PHP变量"><a href="#创建PHP变量" class="headerlink" title="创建PHP变量"></a>创建PHP变量</h2><p>在内核中是如何创建zval的呢，PHP内核中提供了一个MAKE_STD_ZVAL(pzv)宏，它使用内核的方式类申请一块内存，并将其地址赋给pzv。这个宏能自动处理内存不足的问题。<br>获取空间后，就可以给这个zval赋值了。旧的做法是先确定zval的类型：<code>Z_TYPE_P(pzv)=ISNULL</code> 来设置其为null类型，再通过Z_SOMEVAL_P的宏类赋值：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Z_TYPE_P(pzv)=IS_BOOL;</span><br><span class="line">Z_BVAL(PZV)=1;</span><br></pre></td></tr></table></figure>
<p>不过现在PHP内核提供了更多的宏可以更方便的操作zval的值。</p>
<p>新宏    其它宏的实现方法</p>
<ul>
<li>ZVAL_NULL(pvz); <strong>(注意这个Z和VAL之间没有下划线！)</strong>    <code>Z_TYPE_P(pzv) = IS_NULL;</code><strong>(IS_NULL型不用赋值，因为这个类型只有一个值就是null)</strong></li>
<li>ZVAL_BOOL(pzv, b); <strong>(将pzv所指的zval设置为IS_BOOL类型，值是b)</strong>    <code>Z_TYPE_P(pzv) = IS_BOOL; Z_BVAL_P(pzv) = b ? 1 : 0;</code></li>
<li>ZVAL_TRUE(pzv); <strong>(将pzv所指的zval设置为IS_BOOL类型，值是true)</strong>    ZVAL_BOOL(pzv, 1);</li>
<li>ZVAL_FALSE(pzv); <strong>(将pzv所指的zval设置为IS_BOOL类型，值是false)</strong>    ZVAL_BOOL(pzv, 0);</li>
<li>ZVAL_LONG(pzv, l); <strong>(将pzv所指的zval设置为IS_LONG类型，值是l)</strong>    <code>Z_TYPE_P(pzv) = IS_LONG;Z_LVAL_P(pzv) = l;</code></li>
<li>ZVAL_DOUBLE(pzv, d); <strong>(将pzv所指的zval设置为IS_DOUBLE类型，值是d)</strong>    <code>Z_TYPE_P(pzv) = IS_DOUBLE; Z_DVAL_P(pzv) = d;</code></li>
<li>ZVAL_STRINGL(pzv,str,len,dup);<strong>(下面单独解释)</strong>    <code>Z_TYPE_P(pzv) = IS_STRING;Z_STRLEN_P(pzv) = len;if (dup) {Z_STRVAL_P(pzv) =estrndup(str, len + 1);} else {Z_STRVAL_P(pzv) = str;}</code></li>
<li>ZVAL_STRING(pzv, str, dup);    <code>ZVAL_STRINGL(pzv, str,strlen(str), dup);</code></li>
<li>ZVAL_RESOURCE(pzv, res);    <code>Z_TYPE_P(pzv) = IS_RESOURCE;</code></li>
<li>Z_RESVAL_P(pzv) = res;</li>
</ul>
<h2 id="变量的存储方式"><a href="#变量的存储方式" class="headerlink" title="变量的存储方式"></a>变量的存储方式</h2><p>用户在PHP中定义的变量可以在一个HashTable中找到，当PHP中定义了一个变量，内核会自动把它的信息存储到一个用HashTable实现的符号表里。<br>全局作用域的符号表在调用扩展的RINIT方法前创建，并且在RSHUTDOWN方法执行之后自动销毁。</p>
<p>一个例子</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$foo = &apos;bar&apos;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>上面是一段PHP语言的例子，我们创建了一个变量，并把它的值设置为’bar’，在以后的代码中我们便可以使用$foo变量。相同的功能我们怎样在内核中实现呢？我们可以先构思一下步骤：</p>
<ul>
<li>创建一个zval结构，并设置其类型。</li>
<li>设置值为’bar’。</li>
<li>将其加入当前作用域的符号表，只有这样用户才能在PHP里使用这个变量。</li>
</ul>
<p>具体的代码为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    zval *fooval;</span><br><span class="line"></span><br><span class="line">    MAKE_STD_ZVAL(fooval);</span><br><span class="line">    ZVAL_STRING(fooval, &quot;bar&quot;, 1);</span><br><span class="line">    ZEND_SET_SYMBOL( EG(active_symbol_table) ,  &quot;foo&quot; , fooval);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先，我们声明一个zval指针，并申请一块内存。然后通过ZVAL_STRING宏将值设置为‘bar’,最后一行的作用就是将这个zval加入到当前的符号表里去，并将其label定义成foo，这样用户就可以在代码里通过$foo来使用它了。</p>
<h2 id="变量的检索"><a href="#变量的检索" class="headerlink" title="变量的检索"></a>变量的检索</h2><p>在PHP中定义的变量，在内核中通过zend_hash_find()函数来找到当前作用域下用户定义好的变量。zend_hash_find是内核提供的操作hashTable的API之一。<br><a href="http://www.walu.cc/phpbook/2.5.md" title="http://www.walu.cc/phpbook/2.5.md" target="_blank" rel="noopener">http://www.walu.cc/phpbook/2.5.md</a></p>
<h2 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h2><p>我们可以通过符号表获取用户在PHP中定义的变量了，想想一下在PHP中的自动类型转换，它在底层C中是怎么实现的呢。<br>内核中提供了很多函数专门来帮助实现类型转换，这类函数统一的形式为： <code>convert_to_*()</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//将任意类型的zval转换成字符串</span><br><span class="line">void change_zval_to_string(zval *value)</span><br><span class="line">&#123;</span><br><span class="line">    convert_to_string(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//其它基本的类型转换函数</span><br><span class="line">ZEND_API void convert_to_long(zval *op);</span><br><span class="line">ZEND_API void convert_to_double(zval *op);</span><br><span class="line">ZEND_API void convert_to_null(zval *op);</span><br><span class="line">ZEND_API void convert_to_boolean(zval *op);</span><br><span class="line">ZEND_API void convert_to_array(zval *op);</span><br><span class="line">ZEND_API void convert_to_object(zval *op);</span><br><span class="line"></span><br><span class="line">ZEND_API void _convert_to_string(zval *op ZEND_FILE_LINE_DC);</span><br><span class="line">#define convert_to_string(op) if ((op)-&gt;type != IS_STRING) &#123; _convert_to_string((op) ZEND_FILE_LINE_CC); &#125;</span><br></pre></td></tr></table></figure>
<p>其中，convert_to_string其实是一个宏函数，调用的另外一个函数；另外没有convert_to_resource()的转换函数，因为资源的值在用户层面上，根本就没有意义，内核不会对它的值(不是指那个数字)进行转换。</p>
<p>参考： <a href="http://www.walu.cc/phpbook/2.md" title="http://www.walu.cc/phpbook/2.md" target="_blank" rel="noopener">PHP变量在内核中的实现</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/nsq-basic/" itemprop="url">
                  nsq实时消息服务的TCP协议规范
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-07-28T12:34:50+08:00" content="2015-07-28">
              2015-07-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/tools/" itemprop="url" rel="index">
                    <span itemprop="name">tools</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>NSQ是使用golang开发的实时分布式消息处理平台，由bit.ly开源的项目，可以用来处理每天十亿级别的消息。</p>
<p>由于nsq可以直接编译为可执行的二进制文件的特性，nsq的安装非常简单，下载二进制包解压就可以运行了。 参考<a href="http://nsq.io/deployment/installing.html" title="http://nsq.io/deployment/installing.html" target="_blank" rel="noopener">官方文档</a></p>
<p>快速运行也很简单依次在终端中启动nsq的服务即可。这里也不细说了，参考： <a href="http://nsq.io/overview/quick_start.html" target="_blank" rel="noopener">http://nsq.io/overview/quick_start.html</a></p>
<p>关于nsq的几个组件会在后面记一篇，现在主要学习一些nsq中使用的TCP协议规范。</p>
<blockquote>
<p>NSQ的协议足够简单，任何语言编译客户端都很容易。</p>
</blockquote>
<p><strong>nsqd进程通过监听配置的TCP端口来接受客户端连接</strong></p>
<p><strong>对nsq的用途理解有点错误了</strong></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/notes-of-go-by-example/" itemprop="url">
                  Go by Example 中值得注意的点(一)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-07-27T12:34:50+08:00" content="2015-07-27">
              2015-07-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="不定参数"><a href="#不定参数" class="headerlink" title="不定参数"></a>不定参数</h2><p>不定参数的用法已经知道了，函数可以定义如下：</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span> <span class="params">(nums ...<span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">	total := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">		total += num</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> total</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样可以计算任意个传入的int参数的和，但是有下面的用法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nums := []int&#123;1,2,3,4,5&#125;</span><br><span class="line">t := sum(nums...)</span><br></pre></td></tr></table></figure>
<p><code>nums...</code> 这样的用法在之前没有遇到过，它可以用来表示， 将一个slice的元素作为函数的实参列表。</p>
<h2 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h2><p>对于使用过js的人，闭包是一个非常熟悉的概念了。js使用闭包实现内部变量的私有化，go中也有同样的目的？<br>与js不同的是在定义函数的地方要把返回值写明返回的函数的签名。</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">intSeq</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	i := <span class="number">0</span></span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">		i += <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">return</span> i</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样定义的intSeq函数调用后的返回值就是一个函数。</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line">next := intSeq()</span><br><span class="line"><span class="comment">// next是一个命名函数了</span></span><br><span class="line">next()</span><br></pre></td></tr></table></figure>
<p>相比js的闭包，功能不是那么丰富，不过本质差不多。</p>
<h2 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h2><p>Go提供了指针支持，允许传递值的引用。函数的参数可以是某种类型的指针。比如：</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">zeroptr</span><span class="params">(i *<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	*i = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">i := <span class="number">1</span></span><br><span class="line">zeroptr(&amp;i)</span><br></pre></td></tr></table></figure>
<p>对于指针要理解星号（*）符号和引用符号（&amp;）的作用。</p>
<blockquote>
<p>Assigning a value to a dereferenced pointer changes the value at the referenced address.</p>
</blockquote>
<p>语法 <code>&amp;i</code>得到的是<code>i</code>的内存地址，也就是i的指针。也可能存在指向指针的指针。在函数体内部，<code>*i</code>将指针/内存地址 <em>解引用(dereferendes)</em>为地址指向的值。所以赋值语句为<code>*i=0</code>这中形式。</p>
<h2 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h2><p>go中使用关键字struct定义结构体，和C语言的结构体非常相似，不过相比C语言要简单很多了，没有C语言那些复杂的指针维护。<br>结构体可以使用字面量初始化：</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个结构</span></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	age <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">me := Person&#123;<span class="string">"wuxu"</span>, <span class="number">22</span>&#125;</span><br><span class="line">anotherMe := Person&#123;name:<span class="string">"wuxu"</span>, age:<span class="number">22</span>&#125;</span><br><span class="line">mePtr := &amp;me</span><br></pre></td></tr></table></figure>
<p>还是要注意指针的理解， me是一个对象， &amp;me返回的是对象的地址，复制给 mePtr， 如果要将mePtr的内存存放新的对象应该如下:</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line">*mePtr = Person&#123;<span class="string">"new Name"</span>, <span class="number">33</span>&#125;</span><br><span class="line"><span class="comment">// 错误: mePtr =  Person&#123;"new name", 33&#125;</span></span><br></pre></td></tr></table></figure>
<p>修改了mePtr的对象，me的对象也被修改了，因为他们是同一片内存区域。</p>
<h2 id="方法（method）"><a href="#方法（method）" class="headerlink" title="方法（method）"></a>方法（method）</h2><p>我们知道在Go中可以给struct“绑定”方法，其实现方式如下:</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span> <span class="title">say</span><span class="params">(words <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	fmt.Println(p.name, <span class="string">"says: "</span>, words)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Person)</span> <span class="title">run</span><span class="params">(d <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	fmt.Println(p.name, <span class="string">" runs away "</span>, d, <span class="string">" meters"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面给Person结构体绑定了两个方法，看以看到，方法绑定中，一个使用 <code>Person</code> ,一个是 <code>*Person</code>他们有什么区别呢？<br>在方法调用时，Go会自动处理变量和指针的转换，即下面的调用时正确的：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">me := Person(&quot;wuxu&quot;, 22)</span><br><span class="line">me.say(&quot;wtf&quot;)</span><br><span class="line">me.run(100)</span><br></pre></td></tr></table></figure>
<p>虽然run方法的参数类型是 <code>*Person</code>，使用me调用也能正确执行，那么在绑定参数时的<code>*</code>有什么作用？ 这里其实和值与引用相似。不带<code>*</code>的参数相当于值传递，带<code>*</code>的相当于引用传递，所以在say方法中对p的属性修改不会改变调用者的值，而在run方法中修改p的属性会表现在调用者上。</p>
<blockquote>
<p>Go automatically handles conversion between values and pointers for method calls. You may want to use a pointer receiver type to avoid copying on method calls or to allow the method to mutate the receiving struct.</p>
</blockquote>
<p>但是要注意，如果使用 <code>*</code>的话，方法便不再是绑定在Person结构体上了，而是在<code>*Person</code>上了。<br>虽然Person的对象也能调用，这在接口实现中会有表现： 如果一个接口定义了run方法，那么实现这个接口的struct绑定方法时，不能使用<code>*</code></p>
<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>Go的接口，只要定义的类型“绑定”了接口中定义的方法，就认为类型实现了接口。没有implements这类的显式声明实现接口。</p>
<p>一个接口实现的示例：</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> animal <span class="keyword">interface</span> &#123;</span><br><span class="line">  run(<span class="keyword">int</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Pig <span class="keyword">struct</span> &#123;</span><br><span class="line">  name <span class="keyword">string</span></span><br><span class="line">  age <span class="keyword">int</span>                                    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Pig)</span> <span class="title">run</span><span class="params">(d <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">"Pig runs away "</span>, d)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runAway</span><span class="params">(an animal)</span></span> &#123;</span><br><span class="line">  an.run(<span class="number">100</span>);</span><br><span class="line">&#125;                                  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">inters</span><span class="params">()</span></span> &#123;</span><br><span class="line">  runAway(Person&#123;<span class="string">"TM"</span>, <span class="number">22</span>, <span class="literal">false</span>&#125;)</span><br><span class="line">  runAway(Pig&#123;<span class="string">"wangcai"</span>, <span class="number">1</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于接口的更多内容可以查看 <a href="http://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go" title="http://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go" target="_blank" rel="noopener">这篇博客</a></p>
<h2 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h2><p>我们知道Go没有异常系统，而是通过一个显式声明的独立返回值（利用多返回值特性）来声明错误。一般在最后一个返回值声明错误。<br>error是系统提供的返回错误接口，可以自己定制类型实现该接口作为定制的错误类型返回。如果错误位返回nil表示没有错误。</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e myErr)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fmt.Sprintf(<span class="string">"%d - %s"</span>, e.arg, e.prob)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span><span class="title">buy</span><span class="params">(item <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">bool</span>, error)</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> p.age &lt; <span class="number">18</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>, &amp;myErr&#123;<span class="number">0</span>, <span class="string">"too yong"</span>&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>常见的自定义错误如上，注意几点，在返回处， 需要使用 <code>&amp;myErr</code>，否则会报类型错误。如果没有自定义错误，可以直接使用内置的错误类型</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">return false, errors.New(&quot;too yong&quot;)</span><br></pre></td></tr></table></figure>
<p>注意，需要导入errors包。<br>使用自定义错误的好处是可以在调用出对错误做类型判断，已进行相应的处理。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_, e := me.buy(&quot;shirt&quot;)</span><br><span class="line">if me, ok := e.(*myErr); ok &#123;</span><br><span class="line">	// with myErr return, me ref to return error</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h2><p>见第二部分</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/litle-known-css-facts/" itemprop="url">
                  那些你可能不知道但是很有意思的CSS Tricks
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-07-27T12:34:50+08:00" content="2015-07-27">
              2015-07-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/fe/" itemprop="url" rel="index">
                    <span itemprop="name">fe</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>在去年的时候，Louis Lazaris在sitepoint上发了一篇文章 [http</p>
<p>参考：<br><a href="http://www.sitepoint.com/12-little-known-css-facts/" target="_blank" rel="noopener">12 Little-Known CSS Facts</a><br><a href="http://www.sitepoint.com/12-little-known-css-facts-the-sequel/" target="_blank" rel="noopener">12 Little-Known CSS Facts (The Sequel)</a></p>
<p>CSS 本身并不是非常复杂的语言，但是即使你写过很多的CSS样式，你总会感觉到对它并不了解，使用了很多年之后你还是会偶遇很多你没有用过的“有意思”的样式属性，本文作者列举了一些这样的Tricks。</p>
<h2 id="color属性不只是作用域文本"><a href="#color属性不只是作用域文本" class="headerlink" title="color属性不只是作用域文本"></a>color属性不只是作用域文本</h2><p>color属性大家都很熟悉，一般用来设置文本(Text)的颜色属性，但是如果你把body标签的color设置为某种颜色，比如<code>color: yellow</code>几乎所有的东西就都会变成黄色的，包括图片的替代文本，列表的bullet，border等，但是<code>hr</code>标签并不会默认继承这个颜色，需要手动设置 <code>border-color: inherit</code>才会变成黄色。<br>color属性的spec中是这么定义的：</p>
<blockquote>
<p>This property describes the foreground color of an element’s text<br>content. In addition it is used to provide a potential indirect value<br>… for any other properties that accept color values.</p>
</blockquote>
<h2 id="visibility属性可以设置为”collapse”"><a href="#visibility属性可以设置为”collapse”" class="headerlink" title="visibility属性可以设置为”collapse”"></a>visibility属性可以设置为”collapse”</h2><p>所有元素的visibility属性的默认值都是<code>visible</code>, 我们可以把它设置为<code>hidden</code>来隐藏一个元素，与<code>dispaly: none</code>表现不同的是，hidden的元素仍然会占据原来的空间（still occupy space）<br>visibility属性还有一个值就是<code>collapse</code>，它的表现一般和<code>hidden</code>是一样的，但是在table中表现会不一样，可能你已经想到了，在table元素中的行，行组，列，列组中使用<code>collapse</code>属性它的表现和<code>display:none</code>是一样的。<br><strong>不过用于浏览器对这个属性的表现并不一致，所以还是<a href="http://css-tricks.com/almanac/properties/v/visibility/" target="_blank" rel="noopener">不要使用</a>了</strong></p>
<h2 id="background属性有了新的内容"><a href="#background属性有了新的内容" class="headerlink" title="background属性有了新的内容"></a>background属性有了新的内容</h2><p>在CSS 2.1中，background属性有color, image, repeat, attachment, position 5个“子内容”，在CSS3 中，添加很了一些新内容：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">background</span>: <span class="selector-attr">[background-color]</span> <span class="selector-attr">[background-image]</span> <span class="selector-attr">[background-repeat]</span></span><br><span class="line">            [background-attachment] [background-position] / [ background-size]</span><br><span class="line">            <span class="selector-attr">[background-origin]</span> <span class="selector-attr">[background-clip]</span></span><br></pre></td></tr></table></figure>
<p>一个示例：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.example &#123;</span><br><span class="line">  background: aquamarine url(img.png)</span><br><span class="line">	no-repeat</span><br><span class="line">	scroll</span><br><span class="line">	center center / 50%</span><br><span class="line">	content-box content-box;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这些新属性在所有现代浏览器都能正常工作，只不过好像用处也不大。</p>
<h2 id="clip属性只在绝对定位元素上起作用"><a href="#clip属性只在绝对定位元素上起作用" class="headerlink" title="clip属性只在绝对定位元素上起作用"></a>clip属性只在绝对定位元素上起作用</h2><p>clip属性可以用来对元素进行裁剪，它的值是一个图形，比如rect，或者是auto。<br>但是要注意，clip属性只对决定定位元素起作用，包括<code>position: absolute;</code>,和<code>position: fixed</code>两种情况。<br>使用:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.example</span> &#123;</span><br><span class="line">	<span class="attribute">position</span>: absolute;</span><br><span class="line">	<span class="attribute">clip</span>: <span class="built_in">rect</span>(110px, 160px, 170px, 60px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它的表现可以参考这张图片: <img src="http://cdn.impressivewebs.com/2012-05/clip-visual.jpg" alt=""><br>更多关于clip的内容，可以查看<a href="http://www.impressivewebs.com/css-clip-property/" target="_blank" rel="noopener">这里</a></p>
<h2 id="垂直百分比和容器的宽度有关而不是高度"><a href="#垂直百分比和容器的宽度有关而不是高度" class="headerlink" title="垂直百分比和容器的宽度有关而不是高度"></a>垂直百分比和容器的宽度有关而不是高度</h2><p>这个听起来有点奇怪，我们知道百分比计算宽度是基于容器的宽度的，但是实际上padding-top, margin-top, padding-bottom, margin-bottom这些属性的百分比属性也是基于容器的宽度的，而不是高度。<br>这是挺有意思的。</p>
<h2 id="border属性-is-Kind-of-Like-Inception"><a href="#border属性-is-Kind-of-Like-Inception" class="headerlink" title="border属性 is Kind of Like Inception"></a>border属性 is Kind of Like Inception</h2><p>border属性我们会经常使用，比如这样子：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.somecontainer</span> &#123;</span><br><span class="line">	<span class="attribute">border</span>: solid <span class="number">1px</span> black;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们知道border属性是border-style, border=width, border-color三个属性的综合声明。但是其实这三个属性都可以对上下左右四条边分别设置属性：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.somecontainer</span> &#123;</span><br><span class="line">	<span class="attribute">border-width</span>: <span class="number">2px</span> <span class="number">5px</span> <span class="number">1px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样可以把border设置的很复杂，不过在实际使用中，并不要这么用，因为这样使得整个元素显得混乱而导致页面风格混乱。</p>
<h2 id="text-decoration-现在也成为了一种速记符（shorthand）"><a href="#text-decoration-现在也成为了一种速记符（shorthand）" class="headerlink" title="text-decoration 现在也成为了一种速记符（shorthand）"></a>text-decoration 现在也成为了一种速记符（shorthand）</h2><p>新的css规范中，可以这样使用text-decoration属性：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">	<span class="attribute">text-decoration</span>: overline aqua wavy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一个值是<code>text-decoration-line</code>, 第二个是<code>text-decoration-color</code>, 第三个是 <code>text-dcoration-style</code>属性<br>不过这个属性只在firefox中实现了。</p>
<h2 id="border-width属性可以接受关键字值"><a href="#border-width属性可以接受关键字值" class="headerlink" title="border-width属性可以接受关键字值"></a>border-width属性可以接受关键字值</h2><p>现在border-width 可以接受 <code>medium</code>, <code>thin</code>, <code>thick</code>关键字了。他们在浏览器实现中大概是1px, 2px, 5px;不过在spec中并没有指定他们具体的值。</p>
<h2 id="几乎没人使用botder-image"><a href="#几乎没人使用botder-image" class="headerlink" title="几乎没人使用botder-image"></a>几乎没人使用botder-image</h2><p><code>border-image</code>看起来是个不错的属性，使某些表现变得整洁，有一个特别经典的例子是在一圈文字的border加一圈花or狗爪印？不过在现实中几乎没有人会使用这个属性，我也没有使用过。。</p>
<h2 id="empty-cells属性"><a href="#empty-cells属性" class="headerlink" title="empty-cells属性"></a>empty-cells属性</h2><p>这个属性被所有主流浏览器支持，包括IE8。它的用法如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">table</span> &#123;</span><br><span class="line">	<span class="attribute">empty-cell</span>: hide;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个属性用于table元素中空td的样式。或许会有用哦。 测试： <a href="http://codepen.io/SitePoint/pen/yfhtq" target="_blank" rel="noopener">codepen</a></p>
<h2 id="font-style属性接受“oblique”值"><a href="#font-style属性接受“oblique”值" class="headerlink" title="font-style属性接受“oblique”值"></a>font-style属性接受“oblique”值</h2><p>这个看起来和 <code>font-style: italic</code> 并没有什么区别，都是斜体字体，spec中是这么描述的：</p>
<blockquote>
<p>“…selects a font that is labeled as an oblique face, or an italic face if one is not.”</p>
</blockquote>
<p>如果设置的字体没有真正的italic样式（face），那么<code>font-style:italic</code> 和 <code>font-style: oblique</code>的表现是一样的。</p>
<h2 id="word-wrap-属性和overflow-wrap属性是一样的"><a href="#word-wrap-属性和overflow-wrap属性是一样的" class="headerlink" title="word-wrap 属性和overflow-wrap属性是一样的"></a>word-wrap 属性和overflow-wrap属性是一样的</h2><p><code>word-wrap</code>是微软提出的一个属性，所以在IE老版本中都有很好的支持，但是W3C决定使用<code>overflow-wrap</code> 替换掉 <code>word-wrap</code>。但是现在所有的浏览器都支持 <code>word-wrap</code>属性了，所以要替换也不是那么容易的事了。</p>
<p>没什么问题的话还是继续使用<code>word-wrap</code>吧。</p>
<h2 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h2>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/use-yadr-enhancing-your-vim/" itemprop="url">
                  yadr中提供的vim快捷操作
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-07-25T12:34:50+08:00" content="2015-07-25">
              2015-07-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/tools/" itemprop="url" rel="index">
                    <span itemprop="name">tools</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>github上面的活跃的dotfiles项目[yadr](https</p>
<p>这里主要就是官方readme文档的 <a href="https://github.com/skwp/dotfiles/#vim---whats-included" title="https://github.com/skwp/dotfiles/#vim---whats-included" target="_blank" rel="noopener">Vim部分</a> 的记录。基本的vim操作就不详细介绍了。</p>
<p>参考： <a href="http://skwp.github.io/dotfiles/" title="http://skwp.github.io/dotfiles/" target="_blank" rel="noopener">http://skwp.github.io/dotfiles/</a></p>
<h2 id="有什么？"><a href="#有什么？" class="headerlink" title="有什么？"></a>有什么？</h2><p>yadr提供了</p>
<h2 id="导航"><a href="#导航" class="headerlink" title="导航"></a>导航</h2><ul>
<li><code>,z</code> 切换到前一个缓冲文件（buffer），相当于 :bp[revious]</li>
<li><code>,x</code> 切换到后一个缓冲，相当于命令行的 :bn[ext]</li>
<li><code>Alt+j</code> 和 <code>Alt+k</code> 下跳或者上跳一个函数；好像不起作用</li>
<li><code>Ctrl+o</code> 跳转到旧的指针位置，这是vim的标准快捷键，<strong>非常有用</strong></li>
<li><code>Ctrl+i</code> Ctrl+o的逆操作，也是标准按键</li>
</ul>
<h2 id="搜索与代码导航"><a href="#搜索与代码导航" class="headerlink" title="搜索与代码导航"></a>搜索与代码导航</h2><ul>
<li><code>,f</code> 跳转到类定义，需要系统安装了ctags，并创建tags file。</li>
</ul>
<blockquote>
<p>ctags是一个独立的软件，不包含在vim之中，使用yum安装即可，在项目目录下运行 <code>ctags -R .</code> 后会创建tags file，这是就可以使用跳转到定义的功能了。</p>
</blockquote>
<ul>
<li><code>,F</code> 与<code>,f</code>相同不过在新建垂直分屏（vsp）显示定义</li>
<li><code>,gf</code>或者 <code>ctrl+f</code> 跳转到光标坐在变量名对应的文件，但是在一个新的分栏中显示，这在java中比较好用</li>
<li><code>gF</code> 标准快捷键，打开文件</li>
<li><code>K</code> 搜索光标所在单词，并在quickfix窗口显示结果，这个功能需要安装silver serach, <code>sudo yum install -y the_silver_searcher</code></li>
<li><code>,K</code> 没太多用，Grep the current word up to next exclamation point (useful for ruby foo! methods)</li>
<li><code>,hl</code> 开关搜索结果的高亮，相当于 :set noh与其逆操作</li>
<li><code>,gg</code>或者<code>,ag</code>: 搜索，键入这个命令后，会出现一个输入符，在双引号中输入字符后回车会搜索包含这段字符的行</li>
<li><code>,gd</code> 搜索包含字符的函数定义， grep def,不太用</li>
<li><code>,gcf</code> grep current file的缩写，查找对本文件的引用</li>
<li><code>//</code> 清空搜索</li>
<li><code>,,w</code> <code>,&lt;Esc&gt;</code>的alias，EasyMotion，highlights jump-points on the screen and lets you type to get there</li>
<li><code>,mc</code> 多标签，这个功能和sublime中的比较像，在一个单词上面使用<code>,mc</code>会记录这个单词，然后使用<code>Ctrl-n</code>或者<code>Ctrl+p</code>选择前一个或者后一个相同的单词的，或者使用Ctrl+x跳过一个。 这个比较有用</li>
<li><code>gK</code> 打开光标所在单词同名的文档？不常用</li>
</ul>
<h2 id="文件导航"><a href="#文件导航" class="headerlink" title="文件导航"></a>文件导航</h2><ul>
<li><code>,t</code>  文件选择器，不常- 用，键入指令后可以输入字符筛选文件</li>
<li><code>,b</code> 打开缓存区的一个文件，比较常用</li>
<li><code>Cmd-Shift-M</code> 跳转到方法，Linux下好像没用。</li>
<li><code>,jm</code> jump to models,可能在rails里面比较有用</li>
<li><code>Alt+Shift+N</code> nerd tree toogle,好像没什么用</li>
<li><code>Ctrl+\</code> 在侧边栏文件树显示当前文件，和sublime的sidebar有点像</li>
<li><code>Cmd-Shift-P</code> 清空ctrlp 缓存，没用过</li>
</ul>
<h2 id="常用编辑快捷键"><a href="#常用编辑快捷键" class="headerlink" title="常用编辑快捷键"></a>常用编辑快捷键</h2><ul>
<li><code>Ctrl+space</code> 自动补全- ， Tab键</li>
<li><code>,#</code>; <code>,&quot;</code>; <code>,&#39;</code>; <code>,]</code>; <code>,)</code>; <code>,}</code>;  这些优点麻烦的样子，待补充</li>
<li><code>,.</code> 跳转到上一个编辑地点。和<code>&#39;.</code>的作用相同。</li>
<li><code>,ci</code> change inside any set of quotes/brackets/etc。其作用是删除”, {}, ()之间的字符并进入插入模式</li>
</ul>
<h2 id="多标签，多窗口，分割模式"><a href="#多标签，多窗口，分割模式" class="headerlink" title="多标签，多窗口，分割模式"></a>多标签，多窗口，分割模式</h2><ul>
<li><code>alt+n</code> - 快速跳转到指定的tab</li>
<li><code>Ctrl-h,j,k,l</code> 在分栏窗口中上下左右移动。</li>
<li><code>Q</code> 关闭当前的window，<strong>非常方便</strong></li>
<li><code>vv</code> 与 <code>Ctrl-w,v</code>一样，vertical split, 上下分栏</li>
<li><code>ss</code> 与 <code>Ctrl-w,s</code>一样，horizontal split，左右分栏</li>
<li><code>,qo</code> 打开quickfix， qo =&gt; quickfix open, <strong>有用</strong></li>
<li><code>,qc</code> 关闭quickfix,  qc =&gt; quickfix close， <strong>有用</strong>，yadr配置的vim在保存文件时会做语法检查，如果检查不通过会在quickfix窗口显示错误，并且不会自动消失，这时候也许需要 <code>,qc</code>来关闭它。</li>
</ul>
<h2 id="其它常用"><a href="#其它常用" class="headerlink" title="其它常用"></a>其它常用</h2><ul>
<li><code>Ctrl-p</code> 循环历史剪切板，这个很有用，p是粘贴，Ctrl+p会粘贴之前的剪切板内容</li>
<li><code>,yr</code> view yanking, 查看历史复制记录， <code>q</code>退出查看</li>
<li><code>crs</code>, <code>crc</code>, <code>cru</code> cr 应该是 coerce（强制）， s是snake, c是camelcase， u是UPPER，转换变量大小写下划线形式，比较有意思,可以使用<code>:help abolish</code>查看更多</li>
<li><code>:NR</code> NarrowRgn，看名字不知道是干什么的，其实是选中一段代码，然后<code>:NR</code>vim会新开一个split把选中的代码放在心的split中操作，操作完后，<code>wq</code>会把结果覆盖掉原来选中的代码。也挺有用的。</li>
<li><code>,ig</code> toggle visual indentation guids</li>
<li><code>,cf</code> 拷贝当前文件的完整路径到系统剪切板</li>
<li><code>,cn</code> 拷贝文件名</li>
<li><code>,yw</code> yw是从复制从光标位置开始到单词结束，<code>,yw</code>是在任意位置复制整个单词</li>
<li><code>,ow</code> 使用yank buffer中内容覆盖当前所在的单词，ow =&gt; overwrite</li>
<li><code>,ocf</code> 打开所有git标记为修改过的文件，在splits中打开。使用git版本控制下的文件才有用, ocf =&gt; open changed files</li>
<li><code>,w</code> 去掉尾部多余的空格，应该很有用， StripTrailingWhitespaces</li>
<li><code>sj</code> 把单行的hash表格式化为多行的</li>
<li><code>sk</code> unsplit a link 应该不怎么用</li>
<li><code>,he</code> he =&gt; html escape</li>
<li><code>,hu</code> hu =&gt; html unescape</li>
<li><code>Alt+Shift-A</code> align things, 好像没什么用</li>
<li><code>:ColorToggle</code> 顾名思义</li>
<li><code>:Gitv</code> git log browser</li>
<li><code>,hi</code>  显示当前高亮的组</li>
<li><code>,gt</code> Go Tidy， 格式化html代码</li>
<li><code>:Wrap</code> 折叠长行，这个比较有用,特别是quickfix中的提示经常跑出去了 // 好像对quickfix部分不起作用 -_-</li>
<li><code>Cmd-/</code> toggle comments,在Linux下使用alt</li>
<li><code>gcp</code> comment a paragraph</li>
</ul>
<h2 id="vim相关"><a href="#vim相关" class="headerlink" title="vim相关"></a>vim相关</h2><p><code>,vr</code> 重新加载vim， vim reload</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/golang-errors/" itemprop="url">
                  Golang中的错误处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-07-24T12:34:50+08:00" content="2015-07-24">
              2015-07-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>Go语言提供了一套“新颖的”错误系统，与Java中的异常系统不一样，Go中没有抛出异常的概念</p>
<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p>如果有一定面向对象语言编程经验的话，肯定会对异常/错误系统有一定的了解。如果使用Java比较多的话，一定会认为抛异常是编程语言天生的一部分，因为在Java中抛异常真的是太家常便饭，无处不在了；但是在Go语言中，根本没有异常这个东西！</p>
<p>看一段官方的QA是怎么解释这个问题的：</p>
<blockquote>
<p>We believe that coupling exceptions to a control structure, as in the try-catch-finally idiom,<strong> results in convoluted code</strong>. It also tends to encourage programmers to label too many ordinary errors, such as failing to open a file, as exceptional.</p>
<p>Go takes a different approach. For plain error handling, Go’s multi-value returns make it easy to report an error without overloading the return value. A canonical error type, coupled with Go’s other features, makes error handling pleasant but quite different from that in other languages.</p>
<p>Go also has a couple of built-in functions to signal and recover from truly exceptional conditions. The recovery mechanism is executed only as part of a function’s state being torn down after an error, which is sufficient to handle catastrophe but requires no extra control structures and, when used well, can result in clean error-handling code.</p>
</blockquote>
<p>多值返回为Go提供了一个新的错误处理机制，如果对为什么Go不提供异常体系感兴趣可以在 <a href="https://golang.org/doc/articles/defer_panic_recover.html" target="_blank" rel="noopener">这里</a> 找到更多的细节。</p>
<p>在之前文章中，已经使用过Go语言的多值返回来返回详细的错误描述。按照规定，<strong>错误的类型通常为error，这是一个内建的简单接口</strong>。</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> error <span class="keyword">interface</span> &#123;</span><br><span class="line">	Error() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以通过实现这个接口定制错误，例如打开文件时的错误:</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> PathError <span class="keyword">struct</span> &#123;</span><br><span class="line">	Op <span class="keyword">string</span></span><br><span class="line">	Path <span class="keyword">string</span></span><br><span class="line">	Err error	<span class="comment">// 由系统调用返回</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fanc (pe *PathError) Error() <span class="keyword">string</span> &#123;</span><br><span class="line">	<span class="comment">// 返回定制的错误信息</span></span><br><span class="line">	<span class="keyword">return</span> pe.Op + <span class="string">" "</span> + pe.Path + <span class="string">": "</span> + pe.Err.Error()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>effective go中有一个示例非常有利于我们理解错误的使用,这段代码的作用是创建一个文件，如果创建失败，检查是不是磁盘空间不足，如果是则删除掉一些临时文件，再尝试创建一次：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for try:=0; try&lt;2; try++ &#123;</span><br><span class="line">	file, err := os.Create(filename)</span><br><span class="line">	if err == nill &#123;</span><br><span class="line">		return  //没有错误</span><br><span class="line">	&#125;</span><br><span class="line">	// 检查是不是空间不足</span><br><span class="line">	if e,ok := err.(*os.PathError); ok &amp;&amp; e.Err == syscall.ENOSPC &#123;</span><br><span class="line">		deleteTempFiles()  	// 删除一些临时文件</span><br><span class="line">		continue 			// 再创建一次</span><br><span class="line">	&#125;</span><br><span class="line">	return</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以查看源码中PathError的实现 <a href="https://golang.org/src/os/error.go" title="https://golang.org/src/os/error.go" target="_blank" rel="noopener">https://golang.org/src/os/error.go</a></p>
<h2 id="Panic函数"><a href="#Panic函数" class="headerlink" title="Panic函数"></a>Panic函数</h2><p>函数可以通过将error作为额外的返回值来向调用者报告错误，对于一些“致命”的错误，他们导致程序不能继续运行了，Go内建了一个Panic函数，它会产生一个运行时错误并重孩子程序。该函数接受一个任意类型的实参在程序终止时打印。</p>
<p>只需要在需要它的地方调用一下<code>panix()</code>就可以了。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">func init() &#123;</span><br><span class="line">	if user == &quot;&quot; &#123;</span><br><span class="line">		panic(&quot;user变量必须有值&quot;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是一个示例，但是如果是设计库函数则应该避免使用panic，一个常见的使用panic的场景是初始化，如上面的示例。</p>
<h2 id="恢复"><a href="#恢复" class="headerlink" title="恢复"></a>恢复</h2><p>panic函数被调用后，程序将终止当前函数的执行。并开始追溯Go程的栈，运行任何被推迟的函数。我如果回溯到栈顶，程序会终止。<br>我们可以通过使用内建的recover函数来重新取回Go程的控制权。<br>调用recover将停止回溯，并返回传入panic的是西安。因为回溯只有被推迟执行的函数中的代码在执行，所以recover也只能在被推迟的函数中才有效。</p>
<p>一个应用：在服务器中终止失败的Go程而无需杀死其他正在执行的Go程：</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">server</span><span class="params">(workChan &lt;-<span class="keyword">chan</span> *Work)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> work := <span class="keyword">range</span> workChan &#123;</span><br><span class="line">		<span class="keyword">go</span> safelyDo(work)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">safelyDo</span><span class="params">(work *Work)</span></span> &#123;</span><br><span class="line">	<span class="comment">// defer 函数是被推迟执行的</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err := <span class="built_in">recover</span>(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Println(<span class="string">"work failed:"</span>, err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	do(work)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果do函数中调用panic函数，回溯会执行defer的函数，这时recover会起作用，打印错误信息后退出Go程。<br>可以使用上面的思路简化错误处理。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/z-expand-anchor-element-to-fill-parent/" itemprop="url">
                  A标签(Anchor Tag)占满父元素的实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-07-24T12:34:50+08:00" content="2015-07-24">
              2015-07-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/fe/" itemprop="url" rel="index">
                    <span itemprop="name">fe</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>A标签默认是inline元素，所以标签内容的长短决定了鼠标hover的范围，在有些时候，比如某些导航列表中，需要hover父标签（li）时能hover到a标签。</p>
<p>在制作一个API文档的侧边栏导航列表的时候，html大概是这样的</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;toc-macro absolute&quot;&gt;</span><br><span class="line">&lt;ul class=&quot;toc-indentation&quot;&gt;</span><br><span class="line">  &lt;li&gt;&lt;a href=&quot;#id-1&quot;&gt;1. 绑定手机号&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">  &lt;li&gt;&lt;a href=&quot;#id-2&quot;&gt;2. 查询手机号码是否可以绑定&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">  &lt;li&gt;&lt;a href=&quot;#id-3&quot;&gt;3. 添加邮箱&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">  &lt;li&gt;&lt;a href=&quot;#id-4&quot;&gt;4. 检查邮箱是否可以添加&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>其他的样式就不具体写了，其实现的效果是在右侧边栏实现一个列表导航。一些主要的样式大概如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.toc-macro</span>&#123; <span class="attribute">position</span>: fixed; <span class="attribute">top</span>: <span class="number">100px</span>; &#125;</span><br><span class="line"><span class="selector-class">.toc-macro</span> <span class="selector-tag">ul</span> &#123;<span class="attribute">list-style-type</span>:none; &#125;</span><br><span class="line"><span class="selector-class">.toc-macro</span> <span class="selector-tag">a</span> &#123; <span class="attribute">text-decoration</span>: none; &#125;</span><br><span class="line"><span class="selector-class">.toc-macro</span> <span class="selector-tag">li</span> &#123; <span class="attribute">padding</span>: <span class="number">6px</span> <span class="number">8px</span> <span class="number">2px</span>;<span class="attribute">text-decoration</span>:none; &#125;</span><br><span class="line"><span class="selector-tag">li</span><span class="selector-pseudo">:hover</span> &#123; <span class="attribute">background-color</span>: <span class="number">#efefef</span>;<span class="attribute">color</span>: <span class="number">#7DB75C</span>; &#125;</span><br><span class="line"><span class="selector-class">.toc-macro</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123; <span class="attribute">background-color</span>: <span class="number">#efefef</span>;<span class="attribute">color</span>: <span class="number">#7DB75C</span>; &#125;</span><br></pre></td></tr></table></figure>
<p>其中使用了决定定位时导航不会随着滚动条而滚动，使我们在查看API文档时总是能看到这个导航。<br>这样子基本符合我们的需求了，但是有一个小小的问题，那就是鼠标放到导航上如果没有放到a链接上面，li标签会变色，但是由于鼠标没有在a上所以还是箭头的形状。。。这个小小的瑕疵需要解决一下。</p>
<p>首先我们想到的是把a标签的宽度设置到 100%：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.toc-macro a &#123; display:inline-block; width: 100%; &#125;</span><br></pre></td></tr></table></figure>
<p>但是这样似乎并没有按照我们所想的表现出来。我们需要再加一些东西，让a标签的inline-block可以把宽度填充</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.toc-macro li &#123; vertical-align: middle; line-height: 15px;&#125;</span><br></pre></td></tr></table></figure>
<p>另外还有一种实现思路那就是把div下所有标签的display属性设置为block,同时a的height设置为100%：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.toc-macro ul &#123; display: block; &#125;</span><br><span class="line">.toc-macro li &#123; display: block;&#125;</span><br><span class="line">.toc-macro a &#123; display:block; height:100%; &#125;</span><br></pre></td></tr></table></figure>
<p>这样实现应该也是可行的，不过没有测试过了。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/encasulating-a-memcache-client-for-php/" itemprop="url">
                  为PHP封装一个Memcache类
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-07-20T12:34:50+08:00" content="2015-07-20">
              2015-07-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>在php中经常会使用memcache或者memcached来做缓存系统，为了方便操作经常会对PHP提供的接口进行一层封装 </p>
<p>todo</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/go-efficient-string-concat/" itemprop="url">
                  Go 快速拼接字符串
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-07-20T12:34:50+08:00" content="2015-07-20">
              2015-07-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>对于频繁的字符串操作，可以使用bytes.Buffer接口提供的方法快速拼接 </p>
<p>和一般语言类似，Go也为string重载了”+”操作符，可以使用它进行字符串拼接，但是在C#和Java中对于大量的字符串拼接操作推荐使用StringBuilder这样的类，同样对于Go中的大量字符串拼接也不推荐直接使用”+”操作。</p>
<p>可以使用bytes.Buffer提供的方法进行快速拼接：</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bytes"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">concat</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> buffer bytes.Buffer</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">1000</span>; i++ &#123;</span><br><span class="line">		buffer.WriteString(<span class="string">"abcd"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	str := buffer.String()</span><br><span class="line">	<span class="comment">// do something to str</span></span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样可以获得O(n)的时间复杂度。</p>
<p>参考： <a href="http://stackoverflow.com/questions/1760757/" title="http://stackoverflow.com/questions/1760757/" target="_blank" rel="noopener">stackoverflow.com/</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/15/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/17/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/avatar.jpg" alt="wuxu" itemprop="image"/>
          <p class="site-author-name" itemprop="name">wuxu</p>
        </div>
        <p class="site-description motion-element" itemprop="description">Wu Xu的个人博客</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">170</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">23</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">146</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/wuxu92" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/wuxu92" target="_blank">
                  
                    <i class="fa fa-twitter"></i> Twitter
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/kiwidock" target="_blank">
                  
                    <i class="fa fa-weibo"></i> Weibo
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://douban.com/people/wuxu92" target="_blank">
                  
                    <i class="fa fa-douban"></i> Douban
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/wuxu92" target="_blank">
                  
                    <i class="fa fa-zhihu"></i> Zhihu
                  
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wuxu</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
