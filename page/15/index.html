<!doctype html>
<html class="theme-next ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="h7BaHlqi6VjlciSt0RF-KHgIXZcGfx3L3gyQ9qfx_ek" />










  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="wuxu, Golang, C, CPP, CS, PHP, " />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="Wu Xu的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Wu Xu">
<meta property="og:url" content="http://blog.wuxu92.com/page/15/index.html">
<meta property="og:site_name" content="Wu Xu">
<meta property="og:description" content="Wu Xu的个人博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wu Xu">
<meta name="twitter:description" content="Wu Xu的个人博客">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'hide',
    motion: false
  };
</script>

  <title> Wu Xu </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-72131273-1', 'auto');
  ga('send', 'pageview');
</script>





  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>
    <div class="bottomband"></div> <!-- add by wuxu -->
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Wu Xu</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">关注C、Go、C++、JavaScript和UX</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    
      
      

      
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/install-laravel-use-proxy/" itemprop="url">
                  laravel安装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-09-03T12:34:50+08:00" content="2015-09-03">
              2015-09-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/framework/" itemprop="url" rel="index">
                    <span itemprop="name">framework</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>之前一直使用Yii作为主力的PHP框架，但是也有很多人推荐了解学习一下laravel，虽然很多laravel的粉丝宣传的挺过的，但是也准备了解一下laravel。</p>
<p>官方提供的laravel的安装方式是通过composer进行安装，这是php发展的趋势，也是一个好的方向。但是在国内，这种通过网络安装的方式经常会有一些问题。特别是在校内的一台没有联网的机器就更麻烦了，幸好要安装的机器可以通过代理连接网络，这样问题也许还可以解决。</p>
<p>要安装laravel的最新版本，分以下几步： 1.安装composer， 2. 安装laravel</p>
<h2 id="安装composer"><a href="#安装composer" class="headerlink" title="安装composer"></a>安装composer</h2><p>在composer的<a href="https://getcomposer.org/" target="_blank" rel="noopener">官网</a>有详细的资料介绍如何安装，一般使用下面的方式：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -sS https://getcomposer.org/installer | php -- --filename=composer</span><br></pre></td></tr></table></figure>
<p>这里要为curl设置代理：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -sS -x prox_host:port https://getcomposer.org/installer | php -- --filename=composer</span><br></pre></td></tr></table></figure>
<p>这样好像就可以了。其实直接下载一个<a href="https://getcomposer.org/composer.phar" title="https://getcomposer.org/composer.phar" target="_blank" rel="noopener">composer.phar文档</a>也可以，还更加方便呢，在windows 下建议直接下载phar文档，使用官方的exe安装器反而因为网络原因会安装失败。</p>
<p>如果使用命令安装的话可以直接在终端运行composer了，如果下载的是phar归档，则需要添加可执行权限，然后直接运行该归档</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chmod +x composer.phar</span><br><span class="line">./composer.phar</span><br></pre></td></tr></table></figure>
<h2 id="安装laravel"><a href="#安装laravel" class="headerlink" title="安装laravel"></a>安装laravel</h2><p>laravel的安装方式有两种：</p>
<ol>
<li>通过composer安装laravel-installer，再通过installer新建项目</li>
<li>通过composer create-project 直接新建项目。</li>
</ol>
<h3 id="laravel-installer"><a href="#laravel-installer" class="headerlink" title="laravel installer"></a>laravel installer</h3><p>我最开始使用第一种方法，先安装laravel-installer：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">composer require &quot;laravel/installer=~1.1&quot;</span><br></pre></td></tr></table></figure>
<p>要配置代理需要配置环境变量，也可以指直接在bash设置：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set http_proxy=host:port</span><br><span class="line">set https_proxy=host:port</span><br></pre></td></tr></table></figure>
<p>再运行，可能会报<code>[ErrorException] zlib_decode(): data error</code> 这样的错误，这是openssl验证的问题，可以的通过：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">php -r &quot;print_r(openssl_get_cert_locations());&quot;</span><br></pre></td></tr></table></figure>
<p>查看openssl的配置情况并修改配置，但是这样很麻烦，我们可以直接关闭ssl的验证，这环境变量中设置:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP_PROXY_REQUEST_FULLURI=false</span><br><span class="line">HTTPS_PROXY_REQUEST_FULLURI=false</span><br></pre></td></tr></table></figure>
<p>这是再安装就不会有错了。<br>上面的方法会把laravel installer安装到当前目录下的vendor/laravel。可以把这个目录添加到PATH，也可以直接全目录运行。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">laravel new blog</span><br></pre></td></tr></table></figure>
<p>这个命令会通过 Symfony的组件下载文件并新建一个laravel的目录，我在这一步不知道怎么设置代理，第一次网络连接失败，后来一次被我Ctrl-c了。</p>
<h3 id="composer-create-project"><a href="#composer-create-project" class="headerlink" title="composer create-project"></a>composer create-project</h3><p>由于前面把composer配置得可用了，就想应该可以直接使用composer 新建项目了。就使用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">composer create-project laravel/laravel --prefer-dist</span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<p>这样就可以新建一个项目了。文件夹名字为laravel，应该可以自己修改了，剩下的配置一个vhost就可以运行laravel了。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/nginx-rewrite-and-try-files/" itemprop="url">
                  nginx重定向的几点[人生的]经验
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-08-27T12:34:50+08:00" content="2015-08-27">
              2015-08-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/server/" itemprop="url" rel="index">
                    <span itemprop="name">server</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>现在越来越多的server使用nginx做前端，在使用php的项目中越来越多的使用单一入口文件，而且很多时候希望隐藏这个入口文件，生成一个漂亮而简洁的url。以前在apache下是使用一个独立的rewrite模块，或者使用.htaccess文件实现重定向，nginx中需要小小的配置一下。</p>
<p>比如对于一个请求： <a href="http://localhost/index.php?r=c/a&amp;p=v" target="_blank" rel="noopener">http://localhost/index.php?r=c/a&amp;p=v</a> 这样，我们希望请求到 <a href="http://localhost/c/a?p=v。" target="_blank" rel="noopener">http://localhost/c/a?p=v。</a></p>
<p>比较老的做法是配置一个rewrite，以前的项目一般都是这么做的：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">	if ($request_uri !~ &quot;/(index\.php)&quot;) &#123;</span><br><span class="line">        rewrite ^/(.*)$ /index.php/$1 last;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是这样做有可能会导致循环重定向而返回500错误页面。并且有一个问题，就是静态文件也会被转发到index.php。<br>静态文件转发到php-fpm不仅导致做了无用的工作，而且对于允许用户上传图片/文件的应用可能导致安全问题。这是非常不推荐的用法。</p>
<p>为了解决上面的问题，我试过一个稍微麻烦但是能正常工作的方案：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if ($request_uri !~ &quot;/static(.*)&quot; ) &#123;</span><br><span class="line">  set $test  A;</span><br><span class="line">&#125; </span><br><span class="line">if ( !-e $request_filename) &#123;</span><br><span class="line">  set $test &quot;$&#123;test&#125;B&quot;;</span><br><span class="line">&#125; </span><br><span class="line">if ($test = AB) &#123;</span><br><span class="line">  rewrite ^/(.*) /index.php/$1 last;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里假设静态文件都存放在/static目录下。这样可以让静态资源文件不被转发。但是这个方案啊，总觉得不那么优雅。</p>
<p>今天在解决一个问题的时候正好又查了一下，发现现在更多的使用的try_files配置来做重写。try_files的语法如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">try_files file ... uri</span><br><span class="line">try_files file ... = code</span><br></pre></td></tr></table></figure>
<p>其作用域是server 和location，并且不能放在if条件里面。最常用的用法是：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">try_files $uri $uri/ index.php</span><br></pre></td></tr></table></figure>
<p>下面简单解释一下，try_files顾名思义就是尝试读取文件，正是对于请求的脚本不存在的情况，给nginx一个尝试读取脚本的策略。第一个是<code>$uri</code>就是读取uri指定的文件，如果不存在就把请求的看作目录，查找目录下有没有默认index文件（一般配置为index.html, index.htm, index.php）;如果有则读取这个文件。对于try_files的最后一个参数，会作一个 内部重定向/fallback，这个内部重定向可以看作一个内部子请求，会重新被nginx配置match一遍。注意，<strong>只有最后一个参数会发起子请求</strong></p>
<p>在我们的配置里面最后一个参数是index.php这样，会发起一轮新的match会被nginx配置里面的 <code>location ~ .*\.(php|php5).*$ {}</code> catch然后进行转发到php-fpm解析。<br>当请求是静态文件时，因为能直接match的$uri，所以直接就返回静态文件的内容了，对于页面的请求就会转发到index.php.<br>这样就解决了index转发和静态文件不转发的问题，键值优雅得多了。但是有一个问题,那就是参数。</p>
<p>对一般的web框架来说，其请求的url一都是这样样式的：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://host.com/index.php?r=controller/action&amp;param1=value1&amp;...</span><br><span class="line">// 要使用下面的url访问</span><br><span class="line">http://host.com/controller/action?param1=value1&amp;...</span><br></pre></td></tr></table></figure>
<p>需要注意的是，nginx在匹配try_files的最后一项时不会自动把args(也就是querystring)转发出去，需要手动加上，所以对于上面的需求，可以使用下面的配置：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">try_files $uri $uri/ /index.php?r=$uri&amp;$args</span><br></pre></td></tr></table></figure>
<p>这样，对于<code>http://host.com/user/login?username=wuxu&amp;passwd=123</code>，$uri匹配到<code>user/login</code>，$args匹配到<code>username=wuxu&amp;password=123</code>,经过try_files配置之后就是<code>http://host.com/index.php?r=user/login&amp;username=wuxu&amp;password=123</code>了。（当然这里只是用login做示例，实际中的login可不能用GET传递参数哦）。</p>
<p>对于我们自己实现的框架可能有不同的路由方法，相应的修改try_files的策略就可以了。</p>
<p>当然try_files的最后一个参数还可以更复杂，具体可以看nginx的参考文档。</p>
<p>完。</p>
<p>参考: </p>
<ul>
<li><a href="http://wiki.nginx.org/NginxHttpCoreModule#try_files" title="http://wiki.nginx.org/NginxHttpCoreModule#try_files" target="_blank" rel="noopener">http://wiki.nginx.org/NginxHttpCoreModule#try_files</a></li>
<li><a href="https://servers.ustclug.org/2014/09/nginx-try_files-fallacy/" title="https://servers.ustclug.org/2014/09/nginx-try_files-fallacy/" target="_blank" rel="noopener">https://servers.ustclug.org/2014/09/nginx-try_files-fallacy/</a></li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/compile-openresty-in-centos/" itemprop="url">
                  编译安装openresty
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-08-26T12:34:50+08:00" content="2015-08-26">
              2015-08-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/server/" itemprop="url" rel="index">
                    <span itemprop="name">server</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <p>openresty是章亦春（agentzh）维护的项目，早期由淘宝网赞助，后来作者加入cloudflare公司后，也就由该公司支持了。这是一个扩展nginx的项目，在nginx的基础上添加很多作者开发的模块。该项目目前有很多公司在使用。</p>
<p>openresty项目主页 <a href="http://openresty.org/cn/" title="http://openresty.org/cn/" target="_blank" rel="noopener">http://openresty.org/cn/</a>， <a href="http://github.com/agentzh/openresty.org" title="http://github.com/agentzh/openresty.org" target="_blank" rel="noopener">GITHUB</a>。</p>
<p>我们要安装一个openresty作为webserver同时把它配置成与nginx使用方式相同。</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/compile-openresty-in-centos/" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/notes-of-go-by-example-part-5/" itemprop="url">
                  Go by Example(五)：杂烩1
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-08-26T12:34:50+08:00" content="2015-08-26">
              2015-08-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/lang/" itemprop="url" rel="index">
                    <span itemprop="name">lang</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <h2 id="排序包-sort"><a href="#排序包-sort" class="headerlink" title="排序包/sort"></a>排序包/sort</h2><p>go内置的sort包提供了内置类型和用户自定义类型的排序功能。需要注意的sort包的方法对传入的参数排序后直接修改参数，而不是返回一个新的数组。可以这么理解：一般传入排序的是一个数组，数组一般作为引用传递，而对于引用传递的修改直接反映在原数组上。<br>sort包提供对数组排序的函数，函数名为待排序数组元素类型加s，参数为待排序数组，比如</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">strs := []string&#123;&quot;bcd&quot;, &quot;abk&quot;, &quot;opq&quot;, &quot;hij&quot;&#125;</span><br><span class="line">sort.Strings(strs)</span><br><span class="line">// strs has been sorted</span><br><span class="line">sort.StringsAreSorted(strs) // true</span><br></pre></td></tr></table></figure>
<p>同样对于int数组的排序方法为<code>sort.Ints(ints)</code> sort包还提供了一个判断数组是否排序的系列方法，其方法名为参数类型加s加AreSorted(); 比如 <code>IntsAreSorted(ints), StringsAreSorted(strs)</code></p>
<h2 id="给自定义类型排序"><a href="#给自定义类型排序" class="headerlink" title="给自定义类型排序"></a>给自定义类型排序</h2><p>类似于java与其他面向对象语言可以为实现了sortable接口的对象数组进行排序，go也提供了为自定义类型数组进行排序的方法。<code>sort.Sort(myArray)</code>中myArray是一个自定义的类型，它是某种类型的数组类型。比如:</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> myType []<span class="keyword">string</span></span><br></pre></td></tr></table></figure>
<p>要实现排序，也需要为这种类型绑定一些方法，就像实现sortable接口的方法一样。实际上绑定这些方法也是实现go内置定义的 <a href="https://golang.org/pkg/sort/#Interface" title="https://golang.org/pkg/sort/#Interface" target="_blank" rel="noopener">sort.Interface</a>, 要实现Len（） int, Swap和Less() bool三个方法。<br>
          <div class="post-more-link text-center">
            <a class="btn" href="/notes-of-go-by-example-part-5/" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/using-sed-tool-process-text/" itemprop="url">
                  使用sed处理文本
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-08-21T12:34:50+08:00" content="2015-08-21">
              2015-08-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>Linux的文本处理工具除了awk之外，还有一个利器，那就是sed。sed用于文本的替换，也是以行为单位，使用正则表达式进行匹配。</p>
<p>参考： <a href="http://coolshell.cn/articles/9104.html" title="http://coolshell.cn/articles/9104.html" target="_blank" rel="noopener">http://coolshell.cn/articles/9104.html</a></p>
<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><p>sed的命令模式是这样的：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">'sed-command'</span> file-to-process</span><br></pre></td></tr></table></figure>
<p>其中，-i参数是很常用的，如果不带-i参数处理的结果会在终端打印出来，带上-i参数后会将处理结果<strong>替换输入文件</strong>的内容。</p>
<p>中间引号内的是sed的命令内容，常用单引号，但是要注意在单引号里面，反斜杠()转义将不能起作用。命令常用模式为 <code>s/old-pattern/new-str/g</code><br>最后的是要处理的文本的文件名。</p>
<p>由于sed主要依赖正则匹配实现功能，所以先熟悉一下基础的正则规则：</p>
<ul>
<li>^ 表示一行的开头。如：<code>/^#/</code> 以#开头的匹配。</li>
<li>$ 表示一行的结尾。如：<code>/}$/</code> 以}结尾的匹配。</li>
<li><code>\&lt;</code> 表示词首。 如 \&lt;abc 表示以 abc 为首的詞。</li>
<li><code>\&gt;</code> 表示词尾。 如<code>abc\&gt;</code> 表示以 abc 結尾的詞。</li>
<li>. 表示任何单个字符。</li>
<li><code>*</code> 表示某个字符出现了0次或多次。</li>
<li><code>[ ]</code>字符集合。 如：<code>[abc]</code>表示匹配a或b或c，还有<code>[a-zA-Z]</code>表示匹配所有的26个字符。如果其中有<strong>^表示反</strong>，如<code>[^a]</code>表示非a的字符</li>
</ul>
<p>练习：下面的命令可以去掉html文件中的标签，只留下文本：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">"s/&lt;[^&gt;]*&gt;//g"</span> index.html</span><br></pre></td></tr></table></figure>
<p>其中，命令开头的s代表替换，<code>[^&gt;]*</code>表示一个以上的非&gt;字符，替换为空。</p>
<p>上面的命令如果是:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed -i &apos;s/&lt;.*&gt;//g&apos; index.html</span><br></pre></td></tr></table></figure>
<p>看起来也好像能工作，但是， &lt;.*&gt;会匹配最长的尖括号内容，即从文本的第一个&lt; 到最后一个&gt;，这样达不到我们的效果。</p>
<h2 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h2><h3 id="指定替换"><a href="#指定替换" class="headerlink" title="指定替换"></a>指定替换</h3><p><strong>替换指定行的内容</strong><br>有时候我们仅需要对某些行进行替换，可以在命令中指定行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 只对第3行进行替换</span></span><br><span class="line">sed -i <span class="string">'3s/me/you/g'</span> file-name</span><br><span class="line"></span><br><span class="line"><span class="comment">#只对第3-6行替换</span></span><br><span class="line">sed -i <span class="string">'3,6s/me/you/g'</span> file-name</span><br></pre></td></tr></table></figure>
<p><strong>指定每一行替换的个数</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 替换每一行的第一个匹配</span></span><br><span class="line">sed -i <span class="string">'s/me/you/1'</span> file-name</span><br><span class="line"></span><br><span class="line"><span class="comment">#替换每一行的第2个匹配</span></span><br><span class="line">sed -i <span class="string">'s/me/you/2'</span> file-name</span><br><span class="line"></span><br><span class="line"><span class="comment">#替换第5个以后的所有匹配</span></span><br><span class="line">sed -i <span class="string">'s/me/you/3g'</span> file-name</span><br></pre></td></tr></table></figure>
<h3 id="多个匹配"><a href="#多个匹配" class="headerlink" title="多个匹配"></a>多个匹配</h3><p>如果要对一行进行两个匹配，可以在命令字符串中使用;分割多个匹配项：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed &apos;1,3s/me/you/g; 3,$s/you/me/g&apos; file-name</span><br><span class="line"># 下面的命令等效</span><br><span class="line">sed -e &apos;1,3s/me/you/g&apos; -e &apos;3,$s/you/me/g&apos; file-name</span><br></pre></td></tr></table></figure>
<p>这样将1-3行的me替换为you，将3到最后一行的you替换为me。</p>
<h3 id="圆括号匹配"><a href="#圆括号匹配" class="headerlink" title="圆括号匹配"></a>圆括号匹配</h3><p>类似于正则表达式中的分组，在s中使用的括号，可以在替换串中使用\1,\2指代<br>比如：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed <span class="string">'s/This is your \([^,]*\),.*is \(.*\)/\1,\2/g'</span> cats.txt</span><br></pre></td></tr></table></figure>
<p>注意括号部分表示匹配项，括号需要使用斜杠<code>\</code>转义。这与一些编程语言中的规约不一样，一般来说使用$1, $2来指代匹配项。</p>
<h2 id="sed的命令"><a href="#sed的命令" class="headerlink" title="sed的命令"></a>sed的命令</h2><p>sed工具有一些工具用来操作文本，比如在指定行插入行:</p>
<h3 id="a-i-命令"><a href="#a-i-命令" class="headerlink" title="a/i 命令"></a>a/i 命令</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// 在第一行后追加一行</span><br><span class="line">sed &quot;1 a This is your mou, you mou&apos;s name is miaomiao&quot; cats.txt</span><br><span class="line">// 在第一行插入一行，即原来的第一行成为第二行</span><br><span class="line">sed &quot;1 i this is ****&quot; cats.txt</span><br><span class="line">//在文件结尾追加一行</span><br><span class="line">sed &quot;$ a this is ****&quot; cats.txt</span><br><span class="line">// 在所有匹配行后追加一行</span><br><span class="line">sed &quot;/my/a this is my ***&quot; cats.txt</span><br></pre></td></tr></table></figure>
<h3 id="c命令替换匹配行"><a href="#c命令替换匹配行" class="headerlink" title="c命令替换匹配行"></a>c命令替换匹配行</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//替换第二行</span><br><span class="line">sed &quot;c 2 this is my****&quot; cats.txt</span><br><span class="line">// 替换匹配行</span><br><span class="line">sed /my/c this is your****&quot; cats.txt</span><br></pre></td></tr></table></figure>
<h3 id="d命令删除匹配行"><a href="#d命令删除匹配行" class="headerlink" title="d命令删除匹配行"></a>d命令删除匹配行</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// 删除第二行</span><br><span class="line">sed &apos;2s&apos; cats.txt</span><br><span class="line">// 删除从第3行到结尾</span><br><span class="line">sed &apos;3,$d&apos; cats.txt</span><br></pre></td></tr></table></figure>
<h3 id="p命令打印输出"><a href="#p命令打印输出" class="headerlink" title="p命令打印输出"></a>p命令打印输出</h3><p>使用p有点类似grep命令，把匹配行输出</p>
<h2 id="处理目录下所有文件"><a href="#处理目录下所有文件" class="headerlink" title="处理目录下所有文件"></a>处理目录下所有文件</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed -i &apos;2,$s/\t/,\t/g&apos; *</span><br></pre></td></tr></table></figure>
<p>还可以结合grep命令筛选需要处理的文件,这是替换文件内容包含 pattern 的文件。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed -i &apos;command&apos; `grep -rl pattern ./`</span><br></pre></td></tr></table></figure>
<p>grep的l参数表示只输出文件名，r表示recursive</p>
<p>也可以结合 ls 对文件名筛选：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed -i &apos;command&apos; `ls | grep .txt`</span><br></pre></td></tr></table></figure>
<p>这样就只对 txt 文件执行替换。</p>
<h2 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h2>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/14/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/16/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/avatar.jpg" alt="wuxu" itemprop="image"/>
          <p class="site-author-name" itemprop="name">wuxu</p>
        </div>
        <p class="site-description motion-element" itemprop="description">Wu Xu的个人博客</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">175</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">27</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">147</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/wuxu92" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/wuxu92" target="_blank">
                  
                    <i class="fa fa-twitter"></i> Twitter
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/kiwidock" target="_blank">
                  
                    <i class="fa fa-weibo"></i> Weibo
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://douban.com/people/wuxu92" target="_blank">
                  
                    <i class="fa fa-douban"></i> Douban
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/wuxu92" target="_blank">
                  
                    <i class="fa fa-zhihu"></i> Zhihu
                  
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wuxu</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
