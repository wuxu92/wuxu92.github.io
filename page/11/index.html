<!doctype html>
<html class="theme-next ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="h7BaHlqi6VjlciSt0RF-KHgIXZcGfx3L3gyQ9qfx_ek" />










  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="wuxu, Golang, C, CPP, CS, PHP, " />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="Wu Xu的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Wu Xu">
<meta property="og:url" content="http://blog.wuxu92.com/page/11/index.html">
<meta property="og:site_name" content="Wu Xu">
<meta property="og:description" content="Wu Xu的个人博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wu Xu">
<meta name="twitter:description" content="Wu Xu的个人博客">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'hide',
    motion: false
  };
</script>

  <title> Wu Xu </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-72131273-1', 'auto');
  ga('send', 'pageview');
</script>





  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>
    <div class="bottomband"></div> <!-- add by wuxu -->
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Wu Xu</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">关注C、Go、C++、JavaScript和UX</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    
      
      

      
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/csapp-linking/" itemprop="url">
                  CSAPP：链接
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-22T12:34:50+08:00" content="2015-11-22">
              2015-11-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <p><img src="/images/post/csapp2ecover.jpg" alt=""></p>
<blockquote>
<p>链接（linking）是将各种代码和数据部分收集起来并组合成为一个单一文件的过程，这个文件可以被加载到存储器并执行。</p>
</blockquote>
<p>链接可以是在编译时执行（静态链接），或者在加载时执行，甚至在运行时执行（后两者均为动态链接）。在现代操作系统中，链接由链接器（linker）自动执行。</p>
<p>链接器使得分离编译成为可能。可以把程序分解为更小、更好管理的模块，可以独立的修改和编译这些模块，只需要简单重新编译它们，然后重新链接应用，而不需要重新编译其他文件。<br>
          <div class="post-more-link text-center">
            <a class="btn" href="/csapp-linking/" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/movie-life-is-beautiful/" itemprop="url">
                  电影：美丽人生
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-20T12:34:50+08:00" content="2015-11-20">
              2015-11-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/movie/" itemprop="url" rel="index">
                    <span itemprop="name">movie</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>今天下午因为实验室被占用开会就直接没过去了，想在宿舍自己看看书算了。在宿舍果然没法好好看书，看了一会书之后即不想看了，就想着翻一部电影出来看吧。想起来一直都想看的一部《美丽人生》。</p>
<p>之前看过一部日剧也叫《美丽人生》，由木村拓哉和常盘贵子主演的，我很喜欢那部剧。这一部美丽人生的电影则更加有名一些，在IMDB的排行榜是前100，豆瓣评分高达9.5。之前只是知道名字，并不知道讲什么内容。</p>
<p>《美丽人生》的名字很就很有意思，影片一开始讲述了两个很有逗逼的意大利人的一些事情，确实有种意大利人的滑稽与幽默。一开始两人开车被”冒充”国王，碰到女主时自称是王子，开头的半个小时就像一个普通的滑稽戏剧一样。这并没有太多特别的。</p>
<p>如果不是后面的剧情，我只会认为男主圭多就是一个快乐的逗逼，而且是个运气很好的逗逼。总是能逢凶化吉，遇到很多巧合来，制造很多笑料。甚至他对于女主的钟情都有点像是搞笑的。女主像是一个大小姐一样的人，在已经决定要那个市政府的工作人员订婚了，由于和圭多的多次”巧合“而愿意抛弃那个自己并不爱的公务员，和圭多”私奔“了。</p>
<p>意大利人和法国人都有点”民族特色“的浪漫，女主多拉（奥拉）和男主的爱情似乎没有什么理由。圭多很聪明，很幸运，活得很开心，和各色人都关系很好，就是一个自来熟。想干什么就干什么，想见女主了就借各种巧合去了，比如冒充视学官去女主的学校检查工作，上演逗逼的一幕，问到女主要去看话剧就也跑去剧院，并半路把女主从她的未婚夫那”劫走”了。他这种想干就干的性格还是挺讨人喜欢的。两人驾车抛锚之后，直接把车后的红丝绸从阶梯滚下去做红毯，然后用枕头当伞在雨中漫步，男主真是个会玩的主。</p>
<p>喜欢一个人本就是没有什么原因的吧，喜欢了，想见面，越来越喜欢就想在一起，结婚生子。没有什么是注定的，喜欢的人只是因为在这个时间这个地点遇到了，就会喜欢上，然后慢慢的生长，就成了爱，不过或许这也就是注定。</p>
<p>圭多和奥拉在一起后，生活非常幸福（虽然这容易的有点假了）。可是不久纳粹政府就开始掌权了，由于圭多是犹太人，他们的儿子自然也是犹太血统。在他们的儿子生日的那天，圭多父子和他叔叔都被纳粹抓走了。大人们应该都已经知道纳粹的政策了，这次被抓走，可能就再也没有见面的机会了。奥拉并不是犹太人，没有必要去集中营的，但是为了儿子和丈夫义无反顾地上了去往集中营的火车。</p>
<p>即时在残酷的集中营中，圭多用各种办法保护儿子的安全。还和儿子说他们来这里是玩一个游戏的。圭多是如此的乐天而聪明，我一开始都觉得情况并没有那么糟糕嘛。这也许就是快乐是能传染的吧。圭多在儿子面前表现的那种快乐才能欺骗过儿子。即使儿子偶然听到了其他孩子是被送进了毒气室，被烧死了，被用来制作肥皂这样的事情，圭多还是用自己的办法哄骗过去。</p>
<p>圭多用自己的办法为幼小的儿子在黑暗而残酷的集中营搭起了一个快乐的天地，在这里他看不到死亡与折磨，看不到那些惨无人道的事情，而能保持一个孩子的天性。</p>
<p>那一张经典的带着头巾，用毯子做围裙装作妇女，被纳粹军人用枪威胁着大踏步地从儿子所在破铁箱子前走过的剧照，给人留下深刻的印象。即使即将被黑暗的纳粹的力量所撕碎，还是在孩子面前表现得这就是一个游戏，我们即将赢得大奖，让孩子能安全地躲过最后一晚。</p>
<p>最后留给圭多的只有一串枪声，没有一个镜头，从此消失不见。而第二天儿子从破铁箱冲钻出来的时候，正好盟军开着坦克进入了集中营，大兵让他上坦克一起走，在路上终于又找到了妈妈，这圭多祈求的，一直在努力要送给儿子的大奖吧。</p>
<p>如果从常理分析肯定可以说这个电影有很多不合理的地方，但是这部电影应该是有原型故事的，其实现实中发生的事情也总是那么不可思议。有很多事情就是那样神奇的，永远保持一颗乐天，勇敢的心，把人生的残酷作为一个游戏，明天总会是美好的一天。</p>
<p>这部电影，是一部滑稽，浪漫的喜剧，也是一部黑暗而令人窒息的悲剧。希望纳粹这样反人类的事情不要再在这个世界出现。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/csapp-optimizing-program-performance/" itemprop="url">
                  CSAPP：优化程序性能
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-20T12:34:50+08:00" content="2015-11-20">
              2015-11-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <p><img src="/images/post/csapp2ecover.jpg" alt=""></p>
<blockquote>
<p>你能获得的对程序对大的加速比就是当你第一次让它工作起来的时候。<br>–John K.Ousterhout</p>
</blockquote>
<h2 id="优化编译器的能力和局限性"><a href="#优化编译器的能力和局限性" class="headerlink" title="优化编译器的能力和局限性"></a>优化编译器的能力和局限性</h2><p>下面的代码1不能优化为代码2：</p>
<p>代码1：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">teiddle1</span><span class="params">(<span class="keyword">int</span> *xp, <span class="keyword">int</span> *yp)</span> </span>&#123;</span><br><span class="line">    *xp += *yp;</span><br><span class="line">    *xp += *yp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          <div class="post-more-link text-center">
            <a class="btn" href="/csapp-optimizing-program-performance/" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/csapp-understanding-pointer/" itemprop="url">
                  CSAPP：理解指针
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-19T12:34:50+08:00" content="2015-11-19">
              2015-11-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <p><img src="/images/post/csapp2ecover.jpg" alt=""></p>
<p>C语言中最难理解也是最容易出错的的就是指针了，以前学C的时候就最害怕指针，CSAPP中3.10章节理解指针部分，非常有利于加强对指针的理解。</p>
<p>指针是C语言的一个重要特征 。它以一种统一方式，对不同数据结构中的元素产生引用。对于编程新手来说，指针总是会带来很多的困惑，但是基本的概念其实很简单。在此，我们指点介绍一些指针和它们映射到机器代码的关键原则。</p>
<ul>
<li><strong>每一个指针都对应到一个类型</strong>。这个类型表明指针指向哪一类对象。以下面的指针声明为例：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int *ip;</span><br><span class="line">char **cpp;</span><br></pre></td></tr></table></figure>
          <div class="post-more-link text-center">
            <a class="btn" href="/csapp-understanding-pointer/" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/c-link-to-diff-obj/" itemprop="url">
                  C链接不同的 .o 编译可执行文件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-15T12:34:50+08:00" content="2015-11-15">
              2015-11-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>一个方法可以有很多种实现，在a.c种实现func函数，在b.c种也实现func函数，在main中使用了func，可以通过链接时链接到不同的.o文件调用不同的实现。可能描述的不是很清楚，下面用一个例子说明。</p>
<p>现在要实现一个三个整数轮转的函数，就是 int x, y, x要调换他们的值，也就是向右轮转，是y=x, z=y, x=z; 下面有两种实现</p>
<p>a.c</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void decode(int *xp, int *yp, int *zp) &#123;</span><br><span class="line">    int tp1 = *xp;</span><br><span class="line">    *xp = *zp;</span><br><span class="line">    int tp2 = *yp;</span><br><span class="line">    *yp = tp1;</span><br><span class="line">    *zp = tp2; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>b.c</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void decode(int *xp, int *yp, int *zp) &#123;                                                       </span><br><span class="line">    int tx = *xp;</span><br><span class="line">    int ty = *yp;</span><br><span class="line">    int tz = *zp;</span><br><span class="line"></span><br><span class="line">    *xp = tz;</span><br><span class="line">    *yp = tx;</span><br><span class="line">    *zp = ty;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>他们实现了同样的功能，现在在main种调用decode方法。</p>
<p>main.c</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main() &#123;                                                                                   </span><br><span class="line">    int x = 1;</span><br><span class="line">    int y = 2;</span><br><span class="line">    int z = 3;</span><br><span class="line"></span><br><span class="line">    decode(&amp;x, &amp;y, &amp;z);</span><br><span class="line">    printf(&quot;%d, %d, %d\n&quot;, x, y, z);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面就是编译了，使用gcc分别链接到a的.o文件和b的.o文件。<br>先汇编到 .o 文件。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gcc -c a.c</span><br><span class="line">gcc -c b.c</span><br></pre></td></tr></table></figure>
<p>这样会生成 <code>a.o</code> 和 <code>b.o</code> 两个文件，下面编译main.c 生成可执行文件。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gcc -o decode1 a.o main.c</span><br><span class="line">gcc -o decode2 b.o main.c</span><br></pre></td></tr></table></figure>
<p>这样生成两个可执行文件<code>decode1</code> 和 <code>decode2</code>，分别运行他们可以得到其结果是一样的，都输出 <code>3, 1, 2</code></p>
<p>很久没有用C了，很多东西都忘记了。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/vim-open-binary-as-hex/" itemprop="url">
                  vim打开二进制文件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-14T12:34:50+08:00" content="2015-11-14">
              2015-11-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>使用Vim编辑文本文件非常方便，但是打开一个二进制文件的时候会显示乱码，而不能像UltraEdit那样显示十六进制的数据，我们可以用一个小trick实现。<br>一般情况下，打开一个二进制文件如下图所示，我们打开一个 .o 文件</p>
<p><img src="/images/linux/vim-binary.png" alt=""></p>
<p>要让其显示为十六进制的，可以在命令模式键入下面的命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">:%!xxd</span><br></pre></td></tr></table></figure>
<p>这里是运行一个外部命令xxd</p>
<blockquote>
<p> xxd - make a hexdump or do the reverse.</p>
</blockquote>
<p>运行这个命令之后，vim显示如下：</p>
<p><img src="/images/linux/vim-hex.png" alt=""></p>
<p>如果要返回之前的现实，运行下面的命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">:%!xxd -r</span><br></pre></td></tr></table></figure>
<p>这个trick的原理就是使用外部命令xxd生成一个hexdump。</p>
<p>完</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/delete-mongodb-journal-files/" itemprop="url">
                  MongoDB 删除journal文件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-13T12:34:50+08:00" content="2015-11-13">
              2015-11-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/db/" itemprop="url" rel="index">
                    <span itemprop="name">db</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>一台以前用来自己玩的虚拟机，只分配了6G的存储空间，今天进行系统更新的时候报磁盘空间不足。系统总共6G多一点点，主要空间都挂在在 <code>/</code> 下，由于很久没有更新系统了，这次更新需要下载300多M内容，在执行 <code>yum updata</code> 的时候就报磁盘空间不足了。</p>
<p>首先使用df看下空间 <code>df -h</code> 发现确实剩余空间不多了，但是这台机器只是我自己用来玩的，没有其他的东西，估计是记了很多日志吧，使用du看下是哪个目录占用比较多。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd /</span><br><span class="line">sudo du -d 1 -h</span><br></pre></td></tr></table></figure>
<p>du命令的 <code>-d 1</code> 参数表示深度为1， <code>-h</code>使用用户友好的方式返回结果。使用了 -d 就不需要使用 -s 参数了。</p>
<p>查看发现 <code>/usr</code> 目录占用了4G多， <code>/home</code> 和 <code>/var</code> 目录倒都不算大。进usr目录在du看看。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd /usr</span><br><span class="line">du -d 1 -h</span><br></pre></td></tr></table></figure>
<p>发现 <code>lib/mongdb</code> 目录占了很大的空间，再进去看，发现是一个journal文件夹占了3G左右。（如果对Linux比较熟的话，应该认识journal了，journal可以认为是一种日志记录方式，journal程序可以直接查询）</p>
<p>原来是很久以前玩mongodb的时候测试过插百万条数据什么的，估计就留下了这么大的文件。个人认为这是mongodb的事物日志记录，我现在不用mongo了，可以用下面的方法安全地删除掉。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo service mongod stop</span><br><span class="line">sudo vim /etc/mongod.conf</span><br></pre></td></tr></table></figure>
<p>插入一行配置 <code>smallfiles=true</code><br>然后就可以删除那些journal文件了。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo rm /var/lib/mongo/journal/*</span><br><span class="line">sudo service mongod start</span><br></pre></td></tr></table></figure>
<p>这样就空闲了3G的空间了，自己练练手玩还是够的。</p>
<p>完</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/refactoring-method-call/" itemprop="url">
                  重构：简化函数调用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-09T12:34:50+08:00" content="2015-11-09">
              2015-11-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/软件工程/" itemprop="url" rel="index">
                    <span itemprop="name">软件工程</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>有时间再补</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/golang-character-set-and-encoding/" itemprop="url">
                  Go 字符集与编码
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-09T12:34:50+08:00" content="2015-11-09">
              2015-11-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p><img src="/images/golang/gopher-banner-small.jpg" alt=""></p>
<p>Go原生支持Unicode，字符集与编码的问题在编程语言中是很重要的，尤其对于CJK(中日韩)开发者来说。以前很多开发推荐使用GBK编码，现在更加推荐使用UTF-8，虽然UTF-8编码需要更大的存储空间，但是它带来的便利性实在远超过那一些存储空间。现代语言一般都支持Unicode了。着一篇争取对Unicode，UTF-8，UTF-16，ISO-8859有一个系统的了解。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>最早的计算机系统都是使用 EBCDIC(扩展的二进制的十进制转换码) 和 ASCII 编码，因为那时候只是用一些英文字母数字，加减号和其他一些字符，字符并不多，但是随着Internet的发展，网络遍布全球。全球有大概6000种语言（其中3000种在巴布亚新几内亚…） ，为了更好地服务更多的人，我们需要为不同语言的用户提供不同的语言支持。</p>
<p>如果世界只需要 ASCII 编码，那样将会简单很多。但事实却是非常复杂的，现代项目都应该考虑 i18n 和 l10n, 分别代表 internationalisation 和 localisation。i18n指应用能处理各种各样不同的语言和文化， l10n 则是为某个特定的文化团体定制你的国际化应用。</p>
<p>更广泛的i8n不仅仅是文字编码的区别，还要考虑诸如颜色、音乐在不同语言文化中的不同代表意义。但这个领域太过复杂，暂时一般不考虑。</p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><h3 id="Character"><a href="#Character" class="headerlink" title="Character"></a>Character</h3><p>Character 就是字符， </p>
<blockquote>
<p>“the smallest component of written language that has a semantic<br>value</p>
</blockquote>
<p>当然字符也包括自然语言符号之外的一些控制字符。关于字符的内容，可以查看 <a href="https://en.wikipedia.org/wiki/Character" title="维基百科" target="_blank" rel="noopener">维基百科</a></p>
<p><strong>字符集，character code</strong> 字符编码就是将一个字符映射到一个整数，比如最常见的 ASCII编码，将 a 编码为 97（编码点,code point）， A编码为65.编码仍然是抽象的，它仍不是我们在文本或者TCP包中多见到的。</p>
<p><strong>Character encoding</strong> 注意code和encoding是不同的。字符编码（encoding）表示的是其二进制编码。诸如补码，反码等。代表字符 A 在二进制上是怎么存储的。</p>
<p>字符编码（英语：Character encoding）、字集码是把字符集中的字符编码为指定集合中某一对象（例如：比特模式、自然数序列、8位组或者电脉冲），以便文本在计算机中存储和通过通信网络的传递。常见的例子包括将拉丁字母表编码成摩斯电码和ASCII。其中，ASCII将字母、数字和其它符号编号，并用7比特的二进制来表示这个整数。通常会额外使用一个扩充的比特，以便于以1个字节的方式存储。</p>
<blockquote>
<p>按照惯例，人们认为字符集和字符编码是同义词。</p>
</blockquote>
<p><strong>传输编码/Transport encoding</strong>对一段在网络传输的数据需要如何确认它的字符集和编码呢？可以在传输的头部包含一段内容编码信息的内容，就像HTTP头那样。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Content-Type: text/html; charset=ISO-8859-4</span><br><span class="line">Content-Encoding: gzip</span><br></pre></td></tr></table></figure>
<p>但是我们要怎么读到这一段内容呢？因为它们也是要编码的，这就是一个现有鸡还是先有蛋的问题了。但是我们可以做一个约定，这些信息都使用 ASCII 编码，更明确一点就是 US ASCII。因为这一部分信息的内容的功能使用ASCII就能搞定了。</p>
<h2 id="常用编码"><a href="#常用编码" class="headerlink" title="常用编码"></a>常用编码</h2><h3 id="ASCII"><a href="#ASCII" class="headerlink" title="ASCII"></a>ASCII</h3><p>ASCII 编码大家都很熟悉了，大一的时候专业基础课接触到的就是这些内容。作为最常用的编码，ASCII使用的编码点使用7-bit。</p>
<h3 id="ISO-8859"><a href="#ISO-8859" class="headerlink" title="ISO 8859"></a>ISO 8859</h3><p>现在一个字节的标准是8个比特位，作为ASCII的扩展多出来128个编码点。一些列不同的编码集使用了这128个编码点，它们被一些欧洲语言使用，合起来就是 ISO-8859系列。 ISO-8859-1也就是常说的Latin-1，它涵盖了大部分的欧洲语言。<br>ISO-8859是一个系列，系列中所有的低128个编码点就是ASCII编码，以实现兼容。</p>
<p>早期的HTML标准推荐使用ISO-8859-1字符集。不过在 HTML 4 之后就推荐使用 Unicode了。</p>
<h3 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h3><p>像ASCII和ISO8859这样的编码在象形文字（中日韩）语言面前显得就太小气了。中文常用的字多大几千个，至少需要两个字节才能涵括。最初没有统一的国际标准，因此出现了很多的2字节编码方案，比如台湾的Big5，国内的GB2312，BGK；再考虑日本的JIS X 0208等等，字符集简直是一个大乱斗。</p>
<p>Unicode是一个包含所有主要当前在用字符的新的标准，它包括了欧洲，亚洲，印度等等各种语言，Unicode的好处是它是可扩展的。到5.2版本，一共有超过 107000个字符。</p>
<p>Unicode编码点是兼容ISO8859的，也就是说它的前256个编码点就是ISO 8859-1.</p>
<p>要在计算机系统表示一个Unicode字符，需要使用一种编码方式。UCS（通用编码方式）使用两个字节进行编码，然而随着Unicod囊括的字符越来越多，UCS不再使用，而是使用 UTF-*的编码。UTF即 Unicode Transformation format.常见的编码方式如下：</p>
<ul>
<li>UTF-32 试用4字节编码，不常用，尤其是 HTML5 规范明确反对使用它</li>
<li>UTF-16 将最常用的字符编码到2字节，应该也不常用</li>
<li>UTF-8  一个字符使用1-4字节，不定长度，最常用的，对英文字符基本和ISO-8859对应，中文编码为3字符，相比GBK多一个字节</li>
<li>UTF-7  有时使用，但不常用</li>
</ul>
<p>要理解Unicode和UTF-8之间的区别和联系。知道UTF的名字是Unicode转换格式就可以了。Unicode是一个字符集，UTF-8是这个字符集的一种编码方式。</p>
<h2 id="Go与字符集"><a href="#Go与字符集" class="headerlink" title="Go与字符集"></a>Go与字符集</h2><h3 id="UTF-8"><a href="#UTF-8" class="headerlink" title="UTF-8"></a>UTF-8</h3><p>UTF-8 是当前最常用的字符编码，据Google统计50%的网页使用UTF-8编码。我们知道UTF-8的发明者就是Go的作者，也就是Unix的作者Ken。Go使用UTF-8编码的字符组成其字符串。Go的字符串的每一个字符称为一个 <code>rune</code>，它是 <code>int32</code>的别名，因为一个Unicode字符的长度可能是1，2，3，4个字节，如果要统计字符数，就需要计算的是rune的个数而不是字节数了。字符数和字节数只有在是字符串只由ASCII字符组成时才是一样的。</p>
<p>下面是一个中文字符串的示例，它表示出Go中字符串中不同字符占用长度不一样。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">str := &quot;百度一下，你就知道&quot;</span><br><span class="line">fmt.Println(&quot;string len:&quot;, len([]rune(str)))    // 9</span><br><span class="line">fmt.Println(&quot;Byte len&quot;, len(str))				// 27</span><br></pre></td></tr></table></figure>
<p>Go默认就是utf-8编码，所以如果你的项目要使用UTF-8的话，不需要做额外的字符集处理就可以了。</p>
<h3 id="UTF-16"><a href="#UTF-16" class="headerlink" title="UTF-16"></a>UTF-16</h3><h3 id="ISO-8859-1"><a href="#ISO-8859-1" class="headerlink" title="ISO 8859"></a>ISO 8859</h3>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/npwg-application-level-protocols/" itemprop="url">
                  Go 应用层协议
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-07T12:34:50+08:00" content="2015-11-07">
              2015-11-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p><img src="/images/golang/gopher-banner-small.jpg" alt=""></p>
<blockquote>
<p>这两天状态不太好，这一篇写的很糟糕</p>
</blockquote>
<p>在端到端的通信中，是两个程序之间的通信，除了TCP/UDP这样的传输层协议外，我们需要应用之间的通信的协议，这样才能利用/理解传输的数据，这就是我们这一篇的应用层协议。</p>
<h2 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h2><p>应用之间的通信协议设计要考虑下面的问题：</p>
<ul>
<li>广播还是点对点？广播必须是UDP，本地多播或者更加实验性质的MBONE，点对点则可以是UDP和TCP</li>
<li>有状态还是无状态的？有状态的连接对应用更简便，但是要考虑连接奔溃的时候怎么办</li>
<li>传输层协议是否是可靠的？可靠连接一般更慢，但是就不需要担心丢包了，在内网的话UDP的可靠性也是非常高的</li>
<li>是否需要回复(reply)?接收端是否需要给发送方返回一个收到确认，如果要的话要考虑确认丢失，可能要使用超时</li>
<li>使用什么样的数据格式？通常会使用MIME规定的类型，或者使用字节编码数据</li>
<li>是否有突发性大流量的情况？这要考虑QoS(服务质量)，如果突然流量爆发如何处理。</li>
<li>多个流是否有同步的要求？比如视频和音频需要同步时间轴</li>
<li>是一个独立的应用还是为其他人提供的库？</li>
</ul>
<p>设计一个应用层协议，上面是最基本要考虑的点。</p>
<h2 id="数据格式"><a href="#数据格式" class="headerlink" title="数据格式"></a>数据格式</h2><p>消息的数据有两种主要的数据格式，一种是字节编码(byte encoded)，一种是字符编码(character encoded).</p>
<h3 id="字节格式"><a href="#字节格式" class="headerlink" title="字节格式"></a>字节格式</h3><p>使用字节编码格式的数据一般使用第一个字节来区分消息类型。消息的处理器（handler）通过检查第一个字节转向不同的处理流程(不同的消息对应不同的请求)。其他字节是根据某种规定的规则序列化的数据体。</p>
<p>使用字节的优势是数据密度高也因此速度很快，其缺点是数据不透明，这其实也算一个好处，这样别人就难以逆向工程了。如果出现错误将很难被发现，很难调试。常用使用这种格式的是DNS、NFS到Skype。</p>
<p>针对字节数据，Conn 类型提供了读取字节的方法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">func (c Conn) Read(b []byte) (n int, err os.Error)</span><br><span class="line">func (c Conn) Write(b []byte) (n int err os.Error)</span><br></pre></td></tr></table></figure>
<h3 id="字符格式"><a href="#字符格式" class="headerlink" title="字符格式"></a>字符格式</h3><p>使用base64编码后或者将二进制流转变成7-bit使用ascii字符发送。<br>字符格式通常使用多行形式的消息。第一行通常代表消息类型，剩余的数据是消息体数据。常使用行处理的函数。<br>在Go中没有管理字符流的直接支持，只能手动执行“换行”，要注意的是不同操作系统的换行很不一样， Unix系统使用’\n’ 代表换行，Windows系统使用”\r\n”换行，<strong>在internet上”\r\n”更加常用</strong>。</p>
<h2 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h2><p>应用需要管理状态信息来简化当前的操作，可以使用状态来保存应用信息。状态可以由服务器管理也可以由客户端管理。<br>可以使用应用状态转移图表设计状态系统。状态转移图可以跟踪应用的状态以及何时转移到新的状态。</p>
<blockquote>
<p>这一章主要是概念性的东西，状态不太好，记的很乱，ごめ</p>
</blockquote>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/10/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/12/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/avatar.jpg" alt="wuxu" itemprop="image"/>
          <p class="site-author-name" itemprop="name">wuxu</p>
        </div>
        <p class="site-description motion-element" itemprop="description">Wu Xu的个人博客</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">173</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">24</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">145</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/wuxu92" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/wuxu92" target="_blank">
                  
                    <i class="fa fa-twitter"></i> Twitter
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/kiwidock" target="_blank">
                  
                    <i class="fa fa-weibo"></i> Weibo
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://douban.com/people/wuxu92" target="_blank">
                  
                    <i class="fa fa-douban"></i> Douban
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/wuxu92" target="_blank">
                  
                    <i class="fa fa-zhihu"></i> Zhihu
                  
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wuxu</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
