<!doctype html>
<html class="theme-next ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="h7BaHlqi6VjlciSt0RF-KHgIXZcGfx3L3gyQ9qfx_ek" />










  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="wuxu, Golang, C, CPP, CS, PHP, " />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="Wu Xu的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Wu Xu">
<meta property="og:url" content="http://blog.wuxu92.com/page/11/index.html">
<meta property="og:site_name" content="Wu Xu">
<meta property="og:description" content="Wu Xu的个人博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wu Xu">
<meta name="twitter:description" content="Wu Xu的个人博客">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'hide',
    motion: false
  };
</script>

  <title> Wu Xu </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-72131273-1', 'auto');
  ga('send', 'pageview');
</script>





  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>
    <div class="bottomband"></div> <!-- add by wuxu -->
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Wu Xu</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">关注C、Go、C++、JavaScript和UX</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    
      
      

      
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/samba-selinux-config/" itemprop="url">
                  SELinux导致samba共享目录权限错误
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-26T12:34:50+08:00" content="2015-11-26">
              2015-11-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/server/" itemprop="url" rel="index">
                    <span itemprop="name">server</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>之前将一台CentOS 7的机器使用samba共享家目录到Windows系统，方便使用。升级到Windows 10之后一直没有使用，昨天尝试连接samba怎么都连不上。</p>
<p>中间倒腾了很久，找了很多资料，改了很多配置，还是不行，总是报权限不足，请联系管理员什么的，如下图：</p>
<p><img src="/images/post/samba-permission.png" alt=""></p>
<p>总结一下查到的几种可能存在的问题，虽然它们对我的情况好像都没有什么帮助：</p>
<ol>
<li>windows 10会尝试使用samba 3_11链接，而现在samba server一般安装的是4.*的，所以需要disable掉Windows 10 samba 客户端的SMB 2/3协议，来自samba邮件列表 <a href="https://lists.samba.org/archive/samba/2015-September/193886.html" target="_blank" rel="noopener">https://lists.samba.org/archive/samba/2015-September/193886.html</a> ，禁用方法有微软官方方法 <a href="https://support.microsoft.com/en-us/kb/2696547" target="_blank" rel="noopener">https://support.microsoft.com/en-us/kb/2696547</a>。这个很重要</li>
<li>对于无密码的samba共享，还需要设置一个注册表，找到 <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters</code>，新建一个 <code>DWORD(32-bit)Value</code>，设置名字为AllowInsecureGuestAuth，值为1。有的人说这个有用。</li>
<li>防火墙的问题，这个好解决，禁用掉iptables或者firewalld试试就知道了，要在iptables打开相关的端口，可以参考 <a href="http://www.cyberciti.biz/faq/what-ports-need-to-be-open-for-samba-to-communicate-with-other-windowsLinux-systems/" target="_blank" rel="noopener">这篇文章</a></li>
<li>seLinux导致没有权限。这是我遇到的问题，我的server之前是setenfoce=0了的，后来机器断电重启就忘了这事了，结果昨天晚上倒腾好久都没想起来这茬，如果出现上面截图的情况请一定要</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo setenfoce 0</span><br></pre></td></tr></table></figure>
<p>这样就可以了。如果以前可以用现在不可以连接了，一般不会是samba配置的问题，考虑server防火墙和seLinux比较靠谱。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/linking-relocation-and-others/" itemprop="url">
                  CSAPP：链接重定位
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-24T12:34:50+08:00" content="2015-11-24">
              2015-11-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Programming/" itemprop="url" rel="index">
                    <span itemprop="name">Programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p><img src="/images/post/csapp2ecover.jpg" alt=""></p>
<p> 前一篇讲了链接的基础，这里继续链接过程的重定位实现机制以及可执行目标文件的结构和后面的一些内容。</p>
<h2 id="重定位"><a href="#重定位" class="headerlink" title="重定位"></a>重定位</h2><p>前面讲过了链接器的符号解析过程，在符号解析完成之后，代码中的每个符号引用和确定的一个符号定义联系起来了。此时，链接器就知道它的输入目标模块中的代码和数据节的确定大小。此时开始进行重定位，重定位将合并输入模块，并为每个符号分配运行时地址。重定位分两步进行：</p>
<ol>
<li>重定位节和符号定义。 链接器将所有相同类型的节进行合并，形成一个新的聚合节。例如将所有输入模块的 .data 节合并到一个节，这个节成为输出的可执行目标文件的 .data 节。然后链接器将新的存储器地址赋给新的聚合节。此时程序中每个指令和全局变量都有了一个运行时存储器地址了。</li>
<li>重定位节中的符号引用。 对指令和全局变量（定义）重编码后，需要将输入模块的节（代码和数据）中的符号引用进行重定位，使它们指向第一步重定位后的运行时地址。这一步依赖于一个称为 relocation entry(重定位条目)的数据结构。这个条目由<strong>汇编器</strong>生成，链接器根据这个结构的内容确定符号引用的运行时地址。</li>
</ol>
<h3 id="relocation-entry"><a href="#relocation-entry" class="headerlink" title="relocation entry"></a>relocation entry</h3><p>汇编器生产一个目标模块时，它并不知道数据和代码最终存放在存储器的什么位置，所以在汇编器遇到最终位置未知的目标引用时，就生成一个重定位条目（relocation entry），告诉链接器如何在合并成可执行文件时修改这个引用。代码的重定位条目保存在 .rel.text 中，数据的重定位条目存放在 .rel.data 中（见上一篇的可重定位目标文件结构）。</p>
<p>relocation entry的数据结构定义如下：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> offset;</span><br><span class="line">    <span class="keyword">int</span> symbol:<span class="number">24</span>,</span><br><span class="line">        type:<span class="number">8</span>;</span><br><span class="line">&#125; ELF32_Rel;</span><br></pre></td></tr></table></figure>
<p>其中offset是需要被修改的引用的节偏移（相对于节的偏移），symbol是标识被修改的引用应该指向的符号（的地址），type是高职链接器如果修改新的引用。</p>
<p>type有11中，我们只需要知道最主要的两种方式，一种是 R_386_PC32，即使用一个32位PC（程序计数器）相对地址的引用。PC的值通常是存储器中下一条指令的地址。另一种方式R_386_32；重定位使用一个32位绝对地址的引用。</p>
<h3 id="重定位符号引用"><a href="#重定位符号引用" class="headerlink" title="重定位符号引用"></a>重定位符号引用</h3><p>一种重定位算法的伪代码如下所示：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">foreach section s &#123;</span><br><span class="line">    foreach relocation entry r &#123;</span><br><span class="line">        refptr = s + r.offset;</span><br><span class="line">        <span class="keyword">if</span> (r.type == R_386_PC32) &#123;</span><br><span class="line">            refaddr = ADDR(s) + r.offset;</span><br><span class="line">            *refptr = (<span class="keyword">unsigned</span>) (ADDR(r.symbol) + *refptr - refaddr);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (r.type = R_386_32)</span><br><span class="line">            *refptr = (<span class="keyword">unsigned</span>)(ADDR(r.symbol) + *refptr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中ADDR(s)表示s的运行时地址（在节内部符号重定位时，符号和指令的运行时地址已经知道了）。ADDR(r.symbol)是符号的运行时地址。</p>
<p><strong>重定位PC相对引用</strong> 对于PC相对位置的重定位。根据上面的代码分析：refptr是一个地址，其值 <em>refaddr 是相对定位的偏移的值（32位长度）。一定要注意第6行的计算， </em>refptr不要用refptr代入计算了，注意它是一个指针。汇编器会将call指令的引用的初始值设置为 -4 (0xfffffffc)（在不同指令大小和编码方式上可能不一样）。这是因为PC总是指向当前指令的下一条指令，指向 -4 允许链接器透明地重定位引用，而不用知道某一台机器的指令编码。这部分使用一个例子更加清晰，CSAPP Page 462的例子可以仔细看看。</p>
<p><strong>重定位绝对引用</strong> </p>
<h2 id="可执行文件的结构和加载"><a href="#可执行文件的结构和加载" class="headerlink" title="可执行文件的结构和加载"></a>可执行文件的结构和加载</h2><p>链接器将多个目标模块合并成了一个可执行的二进制目标文件。这个二进制文件包含加载程序到存储器并运行它所需的所有信息。一个典型的ELF可执行文件结构如下图所示。</p>
<p><img src="/images/post/exe-obj.png" alt=""></p>
<p>其结构整体和可重定位目标文件差不多，不过因为已经完成了重定位（称作完全链接的），所以没有了  .rel.data 和 .rel.text 节了。多了一个 .init 节，定义了一个_init函数，程序的初始化代码会调用它。</p>
<p>段头部表(segment header table)描述了可执行文件的连续的片(chunk)被映射到连续的存储器段的信息。</p>
<p>shell通过一个驻留在存储器中称为加载器(loader)的操作系统代码来运行生成的可执行文件，任何Unix程序都可以通过调用 <code>execve</code> 函数来调用加载器。</p>
<p>每个Unix程序都一个一个运行时存储器影响，在32位Linux系统中，代码段<strong>总是</strong>从地址 0x08048000 处（小端存储）开始。数据段是接下来的下一个4KB对齐的地址处，运行时堆在读/写段之后接下来的下一个4KB对其的地址处，并通过调用malloc库往上增长。用户栈总是总最大的合法用户地址开始，向下增长的，从栈的上部开始的段是操作系统驻留存储器的部分（内核）保留的。其表示如下图。</p>
<p><img src="/images/post/Linux-run-mem-img.png" alt=""></p>
<p>每个C程序中启动例程的伪代码如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x080480c0 &lt;_start&gt;:</span><br><span class="line">    call __libc_init_first</span><br><span class="line">    call _init</span><br><span class="line">    call atexit</span><br><span class="line">    call main</span><br><span class="line">    call _exit</span><br></pre></td></tr></table></figure>
<p>加载工作的一个概述如下：Unix系统中的每个程序都运行在一个进程上下文中，有自己的虚拟地址空间。当shell运行一个程序时，（父）shell进程生成一个子进程，它是父进程的一个复制，子进程通过execve系统调用启动加载器。加载器删除子进程现有的虚拟存储器段，并创建一组新的代码、数据、堆和栈段。新的栈和堆段被初始化为0.通过将虚拟地址空间中的页映射到可执行文件的页大小的片，新的代码和数据段被初始化为可执行文件的内容。最后加载器跳转到 _start 地址，它最终会调用应用程序的 main 函数。除了一些头部信息，在加载过程中没有任何从磁盘到存储器的数据拷贝。知道CPU引用一个被映射的虚拟页才会进行拷贝，此时操作系统利用它的页面调度机制自动将页面从磁盘传送到存储器。</p>
<p>待续</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/chrome-extension-vimium/" itemprop="url">
                  Chrome插件Vimium
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-23T12:34:50+08:00" content="2015-11-23">
              2015-11-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/tools/" itemprop="url" rel="index">
                    <span itemprop="name">tools</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <p>Vimuim是一款很酷的chrome插件，它能让你使用Vim的方式操作你的chrome浏览器，滚动，打开链接，tab跳转，复制，搜索，功能非常强大。</p>
<p>在有鼠标的时候可以使用鼠标手势快速操作浏览器，但是在使用笔记本（我现在的T430）的时候，基本不使用鼠标，使用小红点浏览网页的时候还是有点麻烦。今天使用了一下大名鼎鼎的Vimium插件，简直解放了我的食指。</p>
<p>首先安装插件，地址是 <a href="https://chrome.google.com/webstore/detail/vimium/dbepggeogbaibhgnhhndojpepiihcmeb?utm_source=chrome-ntp-icon" target="_blank" rel="noopener">https://chrome.google.com/webstore/detail/vimium/dbepggeogbaibhgnhhndojpepiihcmeb?utm_source=chrome-ntp-icon </a> ，另外还有一些类似的插件，像 cVim 等，不过用的最多是这个 Vimium。<br>
          <div class="post-more-link text-center">
            <a class="btn" href="/chrome-extension-vimium/" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/csapp-linking/" itemprop="url">
                  CSAPP：链接
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-22T12:34:50+08:00" content="2015-11-22">
              2015-11-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Programming/" itemprop="url" rel="index">
                    <span itemprop="name">Programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <p><img src="/images/post/csapp2ecover.jpg" alt=""></p>
<blockquote>
<p>链接（linking）是将各种代码和数据部分收集起来并组合成为一个单一文件的过程，这个文件可以被加载到存储器并执行。</p>
</blockquote>
<p>链接可以是在编译时执行（静态链接），或者在加载时执行，甚至在运行时执行（后两者均为动态链接）。在现代操作系统中，链接由链接器（linker）自动执行。</p>
<p>链接器使得分离编译成为可能。可以把程序分解为更小、更好管理的模块，可以独立的修改和编译这些模块，只需要简单重新编译它们，然后重新链接应用，而不需要重新编译其他文件。<br>
          <div class="post-more-link text-center">
            <a class="btn" href="/csapp-linking/" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/movie-life-is-beautiful/" itemprop="url">
                  电影：美丽人生
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-20T12:34:50+08:00" content="2015-11-20">
              2015-11-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/movie/" itemprop="url" rel="index">
                    <span itemprop="name">movie</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>今天下午因为实验室被占用开会就直接没过去了，想在宿舍自己看看书算了。在宿舍果然没法好好看书，看了一会书之后即不想看了，就想着翻一部电影出来看吧。想起来一直都想看的一部《美丽人生》。</p>
<p>之前看过一部日剧也叫《美丽人生》，由木村拓哉和常盘贵子主演的，我很喜欢那部剧。这一部美丽人生的电影则更加有名一些，在IMDB的排行榜是前100，豆瓣评分高达9.5。之前只是知道名字，并不知道讲什么内容。</p>
<p>《美丽人生》的名字很就很有意思，影片一开始讲述了两个很有逗逼的意大利人的一些事情，确实有种意大利人的滑稽与幽默。一开始两人开车被”冒充”国王，碰到女主时自称是王子，开头的半个小时就像一个普通的滑稽戏剧一样。这并没有太多特别的。</p>
<p>如果不是后面的剧情，我只会认为男主圭多就是一个快乐的逗逼，而且是个运气很好的逗逼。总是能逢凶化吉，遇到很多巧合来，制造很多笑料。甚至他对于女主的钟情都有点像是搞笑的。女主像是一个大小姐一样的人，在已经决定要那个市政府的工作人员订婚了，由于和圭多的多次”巧合“而愿意抛弃那个自己并不爱的公务员，和圭多”私奔“了。</p>
<p>意大利人和法国人都有点”民族特色“的浪漫，女主多拉（奥拉）和男主的爱情似乎没有什么理由。圭多很聪明，很幸运，活得很开心，和各色人都关系很好，就是一个自来熟。想干什么就干什么，想见女主了就借各种巧合去了，比如冒充视学官去女主的学校检查工作，上演逗逼的一幕，问到女主要去看话剧就也跑去剧院，并半路把女主从她的未婚夫那”劫走”了。他这种想干就干的性格还是挺讨人喜欢的。两人驾车抛锚之后，直接把车后的红丝绸从阶梯滚下去做红毯，然后用枕头当伞在雨中漫步，男主真是个会玩的主。</p>
<p>喜欢一个人本就是没有什么原因的吧，喜欢了，想见面，越来越喜欢就想在一起，结婚生子。没有什么是注定的，喜欢的人只是因为在这个时间这个地点遇到了，就会喜欢上，然后慢慢的生长，就成了爱，不过或许这也就是注定。</p>
<p>圭多和奥拉在一起后，生活非常幸福（虽然这容易的有点假了）。可是不久纳粹政府就开始掌权了，由于圭多是犹太人，他们的儿子自然也是犹太血统。在他们的儿子生日的那天，圭多父子和他叔叔都被纳粹抓走了。大人们应该都已经知道纳粹的政策了，这次被抓走，可能就再也没有见面的机会了。奥拉并不是犹太人，没有必要去集中营的，但是为了儿子和丈夫义无反顾地上了去往集中营的火车。</p>
<p>即时在残酷的集中营中，圭多用各种办法保护儿子的安全。还和儿子说他们来这里是玩一个游戏的。圭多是如此的乐天而聪明，我一开始都觉得情况并没有那么糟糕嘛。这也许就是快乐是能传染的吧。圭多在儿子面前表现的那种快乐才能欺骗过儿子。即使儿子偶然听到了其他孩子是被送进了毒气室，被烧死了，被用来制作肥皂这样的事情，圭多还是用自己的办法哄骗过去。</p>
<p>圭多用自己的办法为幼小的儿子在黑暗而残酷的集中营搭起了一个快乐的天地，在这里他看不到死亡与折磨，看不到那些惨无人道的事情，而能保持一个孩子的天性。</p>
<p>那一张经典的带着头巾，用毯子做围裙装作妇女，被纳粹军人用枪威胁着大踏步地从儿子所在破铁箱子前走过的剧照，给人留下深刻的印象。即使即将被黑暗的纳粹的力量所撕碎，还是在孩子面前表现得这就是一个游戏，我们即将赢得大奖，让孩子能安全地躲过最后一晚。</p>
<p>最后留给圭多的只有一串枪声，没有一个镜头，从此消失不见。而第二天儿子从破铁箱冲钻出来的时候，正好盟军开着坦克进入了集中营，大兵让他上坦克一起走，在路上终于又找到了妈妈，这圭多祈求的，一直在努力要送给儿子的大奖吧。</p>
<p>如果从常理分析肯定可以说这个电影有很多不合理的地方，但是这部电影应该是有原型故事的，其实现实中发生的事情也总是那么不可思议。有很多事情就是那样神奇的，永远保持一颗乐天，勇敢的心，把人生的残酷作为一个游戏，明天总会是美好的一天。</p>
<p>这部电影，是一部滑稽，浪漫的喜剧，也是一部黑暗而令人窒息的悲剧。希望纳粹这样反人类的事情不要再在这个世界出现。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/csapp-optimizing-program-performance/" itemprop="url">
                  CSAPP：优化程序性能
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-20T12:34:50+08:00" content="2015-11-20">
              2015-11-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Programming/" itemprop="url" rel="index">
                    <span itemprop="name">Programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <p><img src="/images/post/csapp2ecover.jpg" alt=""></p>
<blockquote>
<p>你能获得的对程序对大的加速比就是当你第一次让它工作起来的时候。<br>–John K.Ousterhout</p>
</blockquote>
<h2 id="优化编译器的能力和局限性"><a href="#优化编译器的能力和局限性" class="headerlink" title="优化编译器的能力和局限性"></a>优化编译器的能力和局限性</h2><p>下面的代码1不能优化为代码2：</p>
<p>代码1：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">teiddle1</span><span class="params">(<span class="keyword">int</span> *xp, <span class="keyword">int</span> *yp)</span> </span>&#123;</span><br><span class="line">    *xp += *yp;</span><br><span class="line">    *xp += *yp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          <div class="post-more-link text-center">
            <a class="btn" href="/csapp-optimizing-program-performance/" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/csapp-understanding-pointer/" itemprop="url">
                  CSAPP：理解指针
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-19T12:34:50+08:00" content="2015-11-19">
              2015-11-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Programming/" itemprop="url" rel="index">
                    <span itemprop="name">Programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <p><img src="/images/post/csapp2ecover.jpg" alt=""></p>
<p>C语言中最难理解也是最容易出错的的就是指针了，以前学C的时候就最害怕指针，CSAPP中3.10章节理解指针部分，非常有利于加强对指针的理解。</p>
<p>指针是C语言的一个重要特征 。它以一种统一方式，对不同数据结构中的元素产生引用。对于编程新手来说，指针总是会带来很多的困惑，但是基本的概念其实很简单。在此，我们指点介绍一些指针和它们映射到机器代码的关键原则。</p>
<ul>
<li><strong>每一个指针都对应到一个类型</strong>。这个类型表明指针指向哪一类对象。以下面的指针声明为例：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int *ip;</span><br><span class="line">char **cpp;</span><br></pre></td></tr></table></figure>
          <div class="post-more-link text-center">
            <a class="btn" href="/csapp-understanding-pointer/" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/c-link-to-diff-obj/" itemprop="url">
                  C链接不同的 .o 编译可执行文件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-15T12:34:50+08:00" content="2015-11-15">
              2015-11-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Programming/" itemprop="url" rel="index">
                    <span itemprop="name">Programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>一个方法可以有很多种实现，在a.c种实现func函数，在b.c种也实现func函数，在main中使用了func，可以通过链接时链接到不同的.o文件调用不同的实现。可能描述的不是很清楚，下面用一个例子说明。</p>
<p>现在要实现一个三个整数轮转的函数，就是 int x, y, x要调换他们的值，也就是向右轮转，是y=x, z=y, x=z; 下面有两种实现</p>
<p>a.c</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void decode(int *xp, int *yp, int *zp) &#123;</span><br><span class="line">    int tp1 = *xp;</span><br><span class="line">    *xp = *zp;</span><br><span class="line">    int tp2 = *yp;</span><br><span class="line">    *yp = tp1;</span><br><span class="line">    *zp = tp2; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>b.c</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void decode(int *xp, int *yp, int *zp) &#123;                                                       </span><br><span class="line">    int tx = *xp;</span><br><span class="line">    int ty = *yp;</span><br><span class="line">    int tz = *zp;</span><br><span class="line"></span><br><span class="line">    *xp = tz;</span><br><span class="line">    *yp = tx;</span><br><span class="line">    *zp = ty;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>他们实现了同样的功能，现在在main种调用decode方法。</p>
<p>main.c</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main() &#123;                                                                                   </span><br><span class="line">    int x = 1;</span><br><span class="line">    int y = 2;</span><br><span class="line">    int z = 3;</span><br><span class="line"></span><br><span class="line">    decode(&amp;x, &amp;y, &amp;z);</span><br><span class="line">    printf(&quot;%d, %d, %d\n&quot;, x, y, z);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面就是编译了，使用gcc分别链接到a的.o文件和b的.o文件。<br>先汇编到 .o 文件。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gcc -c a.c</span><br><span class="line">gcc -c b.c</span><br></pre></td></tr></table></figure>
<p>这样会生成 <code>a.o</code> 和 <code>b.o</code> 两个文件，下面编译main.c 生成可执行文件。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gcc -o decode1 a.o main.c</span><br><span class="line">gcc -o decode2 b.o main.c</span><br></pre></td></tr></table></figure>
<p>这样生成两个可执行文件<code>decode1</code> 和 <code>decode2</code>，分别运行他们可以得到其结果是一样的，都输出 <code>3, 1, 2</code></p>
<p>很久没有用C了，很多东西都忘记了。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/vim-open-binary-as-hex/" itemprop="url">
                  vim打开二进制文件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-14T12:34:50+08:00" content="2015-11-14">
              2015-11-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>使用Vim编辑文本文件非常方便，但是打开一个二进制文件的时候会显示乱码，而不能像UltraEdit那样显示十六进制的数据，我们可以用一个小trick实现。<br>一般情况下，打开一个二进制文件如下图所示，我们打开一个 .o 文件</p>
<p><img src="/images/linux/vim-binary.png" alt=""></p>
<p>要让其显示为十六进制的，可以在命令模式键入下面的命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">:%!xxd</span><br></pre></td></tr></table></figure>
<p>这里是运行一个外部命令xxd</p>
<blockquote>
<p> xxd - make a hexdump or do the reverse.</p>
</blockquote>
<p>运行这个命令之后，vim显示如下：</p>
<p><img src="/images/linux/vim-hex.png" alt=""></p>
<p>如果要返回之前的现实，运行下面的命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">:%!xxd -r</span><br></pre></td></tr></table></figure>
<p>这个trick的原理就是使用外部命令xxd生成一个hexdump。</p>
<p>完</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/delete-mongodb-journal-files/" itemprop="url">
                  MongoDB 删除journal文件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-11-13T12:34:50+08:00" content="2015-11-13">
              2015-11-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/db/" itemprop="url" rel="index">
                    <span itemprop="name">db</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>一台以前用来自己玩的虚拟机，只分配了6G的存储空间，今天进行系统更新的时候报磁盘空间不足。系统总共6G多一点点，主要空间都挂在在 <code>/</code> 下，由于很久没有更新系统了，这次更新需要下载300多M内容，在执行 <code>yum updata</code> 的时候就报磁盘空间不足了。</p>
<p>首先使用df看下空间 <code>df -h</code> 发现确实剩余空间不多了，但是这台机器只是我自己用来玩的，没有其他的东西，估计是记了很多日志吧，使用du看下是哪个目录占用比较多。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd /</span><br><span class="line">sudo du -d 1 -h</span><br></pre></td></tr></table></figure>
<p>du命令的 <code>-d 1</code> 参数表示深度为1， <code>-h</code>使用用户友好的方式返回结果。使用了 -d 就不需要使用 -s 参数了。</p>
<p>查看发现 <code>/usr</code> 目录占用了4G多， <code>/home</code> 和 <code>/var</code> 目录倒都不算大。进usr目录在du看看。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd /usr</span><br><span class="line">du -d 1 -h</span><br></pre></td></tr></table></figure>
<p>发现 <code>lib/mongdb</code> 目录占了很大的空间，再进去看，发现是一个journal文件夹占了3G左右。（如果对Linux比较熟的话，应该认识journal了，journal可以认为是一种日志记录方式，journal程序可以直接查询）</p>
<p>原来是很久以前玩mongodb的时候测试过插百万条数据什么的，估计就留下了这么大的文件。个人认为这是mongodb的事物日志记录，我现在不用mongo了，可以用下面的方法安全地删除掉。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo service mongod stop</span><br><span class="line">sudo vim /etc/mongod.conf</span><br></pre></td></tr></table></figure>
<p>插入一行配置 <code>smallfiles=true</code><br>然后就可以删除那些journal文件了。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo rm /var/lib/mongo/journal/*</span><br><span class="line">sudo service mongod start</span><br></pre></td></tr></table></figure>
<p>这样就空闲了3G的空间了，自己练练手玩还是够的。</p>
<p>完</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/10/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/12/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/avatar.jpg" alt="wuxu" itemprop="image"/>
          <p class="site-author-name" itemprop="name">wuxu</p>
        </div>
        <p class="site-description motion-element" itemprop="description">Wu Xu的个人博客</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">176</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">24</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">147</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/wuxu92" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/wuxu92" target="_blank">
                  
                    <i class="fa fa-twitter"></i> Twitter
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/kiwidock" target="_blank">
                  
                    <i class="fa fa-weibo"></i> Weibo
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://douban.com/people/wuxu92" target="_blank">
                  
                    <i class="fa fa-douban"></i> Douban
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/wuxu92" target="_blank">
                  
                    <i class="fa fa-zhihu"></i> Zhihu
                  
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wuxu</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
