<!doctype html>
<html class="theme-next ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="h7BaHlqi6VjlciSt0RF-KHgIXZcGfx3L3gyQ9qfx_ek" />










  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="wuxu, Golang, C, CPP, CS, PHP, " />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="Wu Xu的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Wu Xu">
<meta property="og:url" content="http://blog.wuxu92.com/index.html">
<meta property="og:site_name" content="Wu Xu">
<meta property="og:description" content="Wu Xu的个人博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wu Xu">
<meta name="twitter:description" content="Wu Xu的个人博客">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'hide',
    motion: false
  };
</script>

  <title> Wu Xu </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-72131273-1', 'auto');
  ga('send', 'pageview');
</script>





  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>
    <div class="bottomband"></div> <!-- add by wuxu -->
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Wu Xu</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">关注C、Go、C++、JavaScript和UX</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    
      
      
        
        
        
      

      
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/tmux-inside-tmux/" itemprop="url">
                  在tmux中嵌套一个远程tmux
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2018-03-03T14:31:43+08:00" content="2018-03-03">
              2018-03-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>在远端服务器执行某些很耗时的操作的时候，我们习惯使用tmux（或者scree）来保持远端的进程不因为ssh连接断开而终止。更复杂一点的情况，我们希望使用在tmux中连接一个远端服务器上的tmux会话，这在有些场景下会很方便。</p>
<p>首先描述一下这个场景，我们有一个开发机器A，这是一台局域网服务器，有root权限，用户独立，可以配置无密码登陆的。但是还有一个连接到现网服务的跳板机B，这是一台安全加强的服务器，无root权限并且严格限制用户权限，必须使用token登陆的服务器。每一次登陆B服务器都需要输入变化的Token作为密码，当然我们在B服务器上可以运行tmux会话复用终端，现在的场景是，希望在A服务器保持一个到B服务器的连接，以保证部分任务可以利用这个连接实现无密码在B 服务器上操作。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Local =&gt; A =&gt; B</span><br></pre></td></tr></table></figure>
<p>直接的方法可以在一个tmux会话中ssh到服务器，然后使用ssh连接，然后在服务器 attach 到一个会话，但是这样有一个问题，tmux快捷键前缀复用的问题，一般我们习惯使用 <code>Ctrl+a</code>作为第二前缀，并且一般不怎么使用默认的 <code>Ctrl+b</code> 前缀。在上面的场景中，可以 SSH 到 A 服务器，然后在 A 服务器开启一个tmux会话，在会话中登陆到B服务器（输入一次Token），但是这样不能在这个连接终端复用，需要在这个到B 的连接开启一个Tmux会话，但是用两个问题要解决：</p>
<ol>
<li>上面说的tmux快捷键前缀操作符重复</li>
<li>在显示界面有两个状态栏</li>
</ol>
<p>第一个问题一般可以通过按两次前缀快捷键操作嵌套的B服务器的tmux会话，但是这样很麻烦，像老妈妈操作电脑一样，第二个问题其实比较好解决，可以通过tmux命令隐藏一个状态栏。</p>
<p>一直想怎么能比较“优雅”地解决第一个问题，但是都没有好的方法。之前同事推荐了一个github上面的配置，可以通过一个开关似的快捷键在A的tmux会话和B 的tmux会话之间切换，比按两次前缀好一些，但是要记住当前处于什么会话，也有点不好。</p>
<p>一直有一个想法是通过配置不同的前缀操作键（prefix）实现直接操作B端的会话。理解tmux的快捷键捕获的话这个思路就比较好理解，其实tmux是只捕获前缀按键（prefix）的，如果按下的快捷键不是前缀健就会发送给会话的连接。如果A的没有<code>Ctrl-a</code> 这个前缀，那么“寄居”在A的tux会话中的B 中的tmux会话就可以直接使用 <code>Ctrl+a</code>作为前缀操作了。</p>
<p>但是，有一个问题是tmux的前缀按键是在tmux服务中生效的。我们知道tmux能保持断开ssh连接继续执行，是因为tmux是一个BS架构的服务（tmux二进制文件本身既是服务器端有时客户端），后台运行一个tmux的服务，每次运行tmux，如果没有后台服务则启动一个服务，然后attach上去。如果后台已经有服务了则作为客户端连接到该服务。而prefix是服务启动时绑定的。也就是说prefix不是session级别的，所有的连接都一个服务的session都是一个前缀。</p>
<p>那是否可以通过开启多个tmux服务实现，之前捣鼓的时候尝试在一台服务器上运行两个版本的tmux服务，但是都失败了，如果已运行一个低版本的tmux，不能使用高版本的tmux作为客户端，并且创始使用高版本的tmux启动服务议会报<code>Lost connection</code>。但是对于同一个版本的tmux使用下面的命令可以启动两个服务：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tmux -L t2</span><br></pre></td></tr></table></figure>
<p>但是tmux默认会找 <code>$HOME/.tmux.conf</code> 作为配置文件启动服务，所以会导致新的服务的prefix和之前的一样，所以我们要使用一个别的配置，或者直接使用一个空的配置文件，这样 <code>Ctrl-a</code>就不是新服务的prefix了。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tmux -L t2 -f /dev/null</span><br></pre></td></tr></table></figure>
<p>这样，我们只需要在这个服务上创建会话，然后通过这个会话连接到B服务的tmux session就可以用 <code>Ctrl-a</code> 作为前缀了，这样<strong>一个近乎透明的tmux嵌套</strong>就实现了。几个关键的命令如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 创建服务</span><br><span class="line">tmux -L t2 -f /dev/null</span><br><span class="line"></span><br><span class="line"># 连接到新的服务创建会话</span><br><span class="line">tmux -L t2 [new-session -s jump]</span><br><span class="line"></span><br><span class="line"># 在会话中连接到B服务器</span><br><span class="line"></span><br><span class="line"># 在B中连接到新的会话</span><br><span class="line">tmux attach session-name</span><br></pre></td></tr></table></figure>
<p>这样可以用  <code>Ctrl-b</code>作为A上面的会话的前缀，用<code>Ctrl-a</code>作为B 的会话的前缀，一般来说不需要使用 <code>Ctrl-b</code>的。</p>
<p>可以在A服务器创建一个别名，更快捷地连接B的会话</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 在A 的 bashrc</span><br><span class="line">alias sshb=&apos;tmux -L t2 attach -t jump&apos;</span><br></pre></td></tr></table></figure>
<p>当然可以关闭A上面的tmux的status-bar： <code>Ctrl+b :</code>进入tmux命令输入界面， <code>set status off</code>，就OK了。这样就像是直接连接到B服务器的tmux会话了，实际上是通过A服务器的tmux跳转一层的。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/self-sign-vboxdrv-module-in-secure-boot/" itemprop="url">
                  解决新Fedora下vboxdrv不能加载的问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2017-12-03T22:21:02+08:00" content="2017-12-03">
              2017-12-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <blockquote>
<p>这是一篇旧的笔记，最近Append了一些内容，发出来可能对有的人有用</p>
</blockquote>
<p>Fedora在7月发布了版本号为26的新版本，在上周把家里的笔记本先升级到26踩坑，基本上平滑升级，没有太多问题，gnome的插件也兼容的比较好，除了几个不太常用的基本没有broken的。</p>
<p>可惜的是升级之后VirtualBox不能用，报的是比较常见的kernel driver not installed 的错误，以往按照给的提示操作一下安装好kernel driver就没问题了的，这次折腾了好久也不行。期间尝试过：</p>
<ol>
<li>更新/重装 virtualbox</li>
<li>换到Oracle的源安装VirtualBox</li>
<li>手动运行 <code>/sbin/vboxconfig</code>，编译kernel driver</li>
<li>禁用modprobe <code>kvm_intel</code> <a href="http://www.Linuxquestions.org/questions/linux-newbie-8/modprobe-vboxdrv-error-i%27m-stuck-for-3days-4175493638/" target="_blank" rel="noopener">Ref</a>  再重装<br>5.安装旧版本内核后重装virtaulbox</li>
</ol>
<p>毫无意外以上的方法都失败了，经过一顿折腾感觉问题应该处在 secure boot上面， 想进BIOS把secure boot关掉，但是发现笔记本的BIOS密码忘记了，这条路也走不通了，不过我感觉就算关掉secure boot应该也不行。</p>
<p>后来找到<a href="https://gorka.eguileor.com/vbox-vmware-in-secureboot-Linux/" target="_blank" rel="noopener">一篇文章</a>，自己对这个mod签名”骗过”操作系统，其实之前也看到了这篇文章，但是觉得有点麻烦就没怎么细看，今天研究了一下，其实也挺好处理的，就是生成一个key，然后用这个key给未签名的module签名，再通过mokutil导入key，重启系统就可以了，关键命令记录如下，具体细节可以查看原文。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo modprobe -v vboxdrv        # 查看mod信息，在这可以看到报错信息</span><br><span class="line"># 生成key， 包括der和priv文件</span><br><span class="line">openssl req -new -x509 -newkey rsa:2048 -keyout MOK.priv -outform DER -out MOK.der -nodes -days 36500 -subj &quot;/CN=Akrog/&quot;</span><br><span class="line"></span><br><span class="line"># 使用生成的key为mod签名</span><br><span class="line">sudo /usr/src/kernels/$(uname -r)/scripts/sign-file sha256 ./MOK.priv ./MOK.der $(modinfo -n vboxdrv)</span><br><span class="line">sudo mokutil --import MOK.der    # 导入，注意这里要用sudo执行，前面可以用普通用户执行</span><br><span class="line"># 这里会提示输入密码，这个是重启时导入证书需要输入的密码</span><br><span class="line"></span><br><span class="line">sudo reboot        # 重启进入导入证书的界面，按照操作即可</span><br><span class="line">dmesg | grep &apos;EFI: Loaded cert&apos;    # 启动后查看我们刚刚生成的证书已经加载</span><br><span class="line"></span><br><span class="line"># 重启后vboxdrv会自动加载，直接启动virtualbox即可。</span><br></pre></td></tr></table></figure>
<p>VirtualBox可能会再运行时导致Host的CPU利用率飙升至100%，可能的原因是开启了vb的nested paging设置，再设置里面关掉可能就好了，该项设置可能需要先关闭虚拟机，设置路径在： <code>Setting - System - Acceleration</code>。go to the system tab, click on Acceleration and then uncheck the Enable Nested Paging checkbox.  Click OK and start the virtual machine up and you should quickly notice some performance improvements 参考： <a href="http://www.dotnetmafia.com/blogs/dotnettipoftheday/archive/2010/09/22/fix-high-guest-cpu-utilization-in-virtualbox-by-disabling-nested-paging.aspx" target="_blank" rel="noopener">DotNetMafia</a><br>和有一个CPU 飙升到100%的问题可能时虚拟机内某些程序有bug，比如我常用的为知笔记的后台进程就经常发疯到100%，在windows task manager 中kill掉就好了。</p>
<p>APPEND:</p>
<p>每次升级内核会出现模块签名无效的问题，所以升级内核需要使用对应新内核的 sign-file 脚本执行一遍，可能除了 <code>vboxdrv</code>，还有其他模块需要签名的，这些需要签名的列表可以在 执行 <code>sudo systemctl restart systemd-modules-load.service</code> 之后（这时通常会失败）,通过 <code>journalctl -xe</code> 命令查看，只需要找出加在失败的模块然后使用之前使用过的 MOK.priv 和 MOK.der 两个文件签名一下就可以了，如果旧的密钥文件丢失了，就重新走一遍上面的流程，如果有旧的MOK文件则不需要 import MOK.der 的阶段了，比如升级 4.13.16内核之后就需要重新签名好几个module：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo /usr/src/kernels/$(uname -r)/scripts/sign-file sha256 ./MOK.priv ./MOK.der $(modinfo -n vboxnetflt)</span><br><span class="line">sudo /usr/src/kernels/$(uname -r)/scripts/sign-file sha256 ./MOK.priv ./MOK.der $(modinfo -n vboxnetadp)</span><br><span class="line">sudo /usr/src/kernels/$(uname -r)/scripts/sign-file sha256 ./MOK.priv ./MOK.der $(modinfo -n vboxnetpci)</span><br><span class="line">sudo /usr/src/kernels/$(uname -r)/scripts/sign-file sha256 ./MOK.priv ./MOK.der $(modinfo -n vboxpci)   </span><br><span class="line">sudo systemctl restart systemd-modules-load.service</span><br></pre></td></tr></table></figure>
<p>当然也可以禁用内核的升级省得麻烦，毕竟个人系统对内核版本要要求也没有那么严格，只要在 <code>/etc/dnf/dnf.conf</code>中加入 <code>exclude=kernel*</code> 这样的一行就会在 <code>dnf update</code>的时候排除kernel的更新了。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/the-loomig-storm/" itemprop="url">
                  《暴雪降至》：不是罪案片
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2017-11-19T13:56:47+08:00" content="2017-11-19">
              2017-11-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/movie/" itemprop="url" rel="index">
                    <span itemprop="name">movie</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p><img src="/images/movie/looming-storm.jpg" alt="暴雪降至剧照"><br>吃完一堆垃圾食品，又写了几行代码之后，去看了这部把段奕宏送上东京电影节影帝的《暴雪降至》。</p>
<p>在之前就看了几篇短评，大部分无非是拿这部电影和韩国的《杀人回忆》做比较，是中国版的《杀人回忆》云云，但是看到海报就感觉这应该是部不错的片子，就买了附近最晚的一场，正好看完回家。</p>
<p>片子的开头是有点平庸的惯用手法，男主在第一镜以一个背影出场，没有人露脸，台词冷冰冰地带出故事。当然很多人乐于称道的对于男主人公名字“余国伟”的解释，算是第一个小亮点吧。从派出所出来，男主走在街上听到车的声音而回头等车的现身，漫长的等待之后，看到的却是10年前的自己，一个漂亮的剪切，故事正是开始了。有人说这个片子不会剪辑，真的是在搞笑，这个镜头扔他脸上。</p>
<p>这个片子一个很大的亮点就是各种伏笔、隐喻和前后呼应，比如刚出场男主老余的车坏了，自己推到案发现场，然后让徒弟小刘把车推回去这一个场景，到后面警察局的车也坏了，李警官让老余下去推车，李警官和老警察老张坐在车里。这两个镜组合起来就可以表达很多东西了吧。老余是一个厂子里抓小偷的保安科长，一心想进入体制内的警察局，老余的小徒弟一心想成为老余那样“神探”， 而警察局的李警官呢，估计是想早点调到市局、省局去，但是可惜他们的车都容易坏。这里有一个设计的很好的镜头，老余在后面推车，摄影机在车子里面往后面拍，仿佛我们是在车里的人，老余是外面的人，我们把老余扔到了外面。</p>
<p>还有一个场景，老警察推测凶手作案是先把受害者打晕绑在自行车上运送到案发地点，然后一个镜头切换，老余骑着自行车，把徒弟小刘的手绑在自己身上，这不就是爱森斯坦的一加一等于三？这里就暗示了小刘和那写被杀害的女性没有什么区别，而小刘被害凶手可以说就是老余，当然这里每个人可以有自己的解读，要说过分解读也没错。但是一个老警察描述的场景，一个拍摄的真实场景，两个直接对比冲撞之下，意义凸显：他们什么地方是一样的，什么地方是不一样的？肯定是为了要表现出一些东西的。这里也是整个片子很多伏笔中的一个。</p>
<p>刚开始看，段奕宏有点出戏，但是慢慢的就能感觉到段奕宏表演的技巧很强，很稳健，有时候会担心某个场景会崩塌，但是一转眼段奕宏就处理的非常好，怪不得可以拿到东京电影节的最佳男演员了。这样的演员就是基本不会失手的那种级别了，因为他不是局限于某一种类型某一类角色的演员了，有自己的一套表演方法，也就是说以后只要是段奕宏演的角色，就算剧本崩塌，他这个角色也应该是能撑起来的那种。</p>
<p>老余和燕子（江一燕）在理发店的几个场景是最好的几场戏。江一燕的演技有点不稳定，总的来说在理发店的戏是她发挥最好的地方了。还有就是在桥上的几个镜头，贯穿整个戏，天空总是阴着的，似乎永远不会停止的雨水，很少见到阳光，烟囱冒出浓烟，和人印象中的一样总蒙着一层灰的工厂，所有的人都是青黑色的雨衣，灰色的雨伞，灰色的工作服，黑色的鞋子，脏兮兮的街道和布满水坑的泥泞的马路；只有几处暖色调的景，一个是在燕子原来的住所，但那是一个进行皮肉交易的地方，在一个道德认为最肮脏的地方，却是全片暖色调最集中的地方；当然这可能并没有什么特别的意味，因为使用暖色调表现暧昧情调是惯用的手法，但是放在这个片子里面却有了意外的惊喜的效果了。</p>
<p>除了理发店的戏，就是老余和燕子在桥上的几个场景最喜欢了，天空仍旧是阴灰的，似乎没有下雨，但也没有放晴，云压的很低，老余仍然是灰色的衣服，一眼望去，城市是灰色的，房子都很老且破，老旧的火车开过，桥也是老旧的。但是燕子的衣服是暖色的，一次是黄色的线衣，一次是深红色的外套，很漂亮的对比。在这桥上还有全片最浪漫的一个错位镜头，可能很多人没有注意到，通过一个两人延长线上的机位的摄影，老余和燕子似乎拥抱在一起，并且燕子坐在桥墩上，位置偏高一点，这样就成了老余的头靠在了燕子的肩上，这肯定是一个特意设计的镜头，很浪漫是不是，但是一段蒙太奇剪辑回来之后，燕子像一片羽毛一样轻盈地倒身从桥上跳下去，下面是正疾驰而过的火车。这是全片最震撼、最大胆的一个镜头，看到这吓了一跳。</p>
<p>就电影工业水平而言，在工厂的那场追逐的戏可以担起重任，非常精彩。很少在国产电影中看到这样的，至少看起来很真实的工厂追逐的大场景戏码，除去精彩的追逐戏，这里也埋下了一个伏笔：凶手是一个身手矫健的人，和老余认定的“凶手”完全不可能是一个人，但是老余还是认定了那个宛如智障的话都说不清楚的人是凶手，这更加表现出了老余的迷失和注定的悲剧。片子还有很多的类似的细节，非常多有些也记不清楚了，以后出资源了可以再拉一遍。</p>
<p>还是要说一下和《杀人回忆》的事情，很多人都拿这部片子和《杀人回忆》对比，甚至说什么低配版，什么拙劣的模仿，什么段奕宏努力地要成为一个宋康昊，真是太搞笑了，这片子和《杀人回忆》就不是一类，要表现的主题都完全不一样，更不要说背景和角色设定，剧情推进各个方面的差异。非要说有一样的地方，雨多算一个，但是《暴雪降至》贯穿全片的阴雨，大半时间都在暴雨，这么大胆的设计就比《杀人回忆》走的更远了，而另一个相似的地方就是连环杀人的设定，这个并不能作为两个影片类同的依据不想多说。而《暴雪降至》明显比《杀人回忆》想要表现更多的东西，或者有不一样的东西，这些东西是和我们的环境、和当时的历史情节绑定在一起的。</p>
<p>且不说宋康昊除了在韩国自己的电影节拿奖拿到手软，在国际A类电影节的竞赛单元成就基本是零，连提名都没几个，段奕宏怎么说两个A类电影节影帝，宋说破天算个前辈而已，何以就段奕宏要努力地成为一个宋康昊。虽然几年前我也吹韩国电影，但是现在发现有的人吹的过分了；韩国电影就一个好：故事讲的好，拍一个大家看完觉得还不错的片子很容易，而国产的很多片子就是连故事都讲不好。但是要说高水平，格局和突破性，国产片不要虚的啊。</p>
<p>如果要说《暴雪降至》的缺点，那就是故事差点火候，就是没有那种很硬很惊艳的感觉，后期略显乏力，这似乎是所有国产电影的弱项，不过并不是说这个片子故事性不强，只是相对而言这一方面弱一点，总的来说瑕不掩瑜。还有一点是结局的处理有点可惜，本来老余背起包上了大巴车准备离开，但是大巴车熄火，天下起了雪，暴雪即将到来，是一个我非常喜欢的设计，有很多的暗示和隐喻在里面，如果体验过湖南2008年的那场大雪，估计能有更多的想法。但是最后一幕文字说明雪灾有多严重却有点突兀和多余，可能对没有经历过那场雪灾的观众是一个补充，但是这一幕的破坏性也很强的。</p>
<p>最后，不是所有看不懂的片子都是文艺片，不是说所有有警察和罪犯的片子都是罪案推理片。</p>
<blockquote>
<p>最近还在学习怎么看电影，如果你也感兴趣，推荐看看纪录片《电影史话》，在Bilibili有电影频道的国语配音版，网上也有原版的资源，还有经典的《认识电影》和《世界电影史》都是了解电影的入门书籍，都值得推荐。</p>
</blockquote>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/convert-all-gbk-files-to-utf8-md/" itemprop="url">
                  Conver all GBK files to UTF8
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2017-10-21T22:50:36+08:00" content="2017-10-21">
              2017-10-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p><em>水一篇水一篇，要不要发霉了</em><br>平时的整轨音乐文件作者在发布的时候使用的播放列表文件（cue/m3u/m3u8）大部分都是 BGK编码的，在qmmp播放时不能正确识别GBK编码的文件，之前都是用vscode一个个复制转码保存，今天处理歌神的一个合集时发现文件实在太多了，就想着用bash处理以下，发现非常简单的一个命令就能搞定了：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">while read -r f; do echo &quot;Processing $f...&quot;; iconv -f GBK -t utf8 -o &quot;$&#123;f%%cue&#125;utf8.cue&quot;  $f; done &lt;&lt;&lt; $(find ./ -name &apos;*.cue&apos;);</span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<p>就是用iconv命令进行转码，上面的命令可以将当前目录下的所有 .cue 文件从 BGK 转码为 UTF8 并保存为一个带 .utf8.cue 的同目录下的文件，这样使用起来就很方便了。</p>
<p>虽然很简单也很水，但很好用啊。。。。</p>
<p>再附一个处理所有的的详细版(要排除了一些之前手动处理过的文件)：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! /bin/bash</span><br><span class="line"></span><br><span class="line"># mydir=$(readlink -e `dirname $0`)</span><br><span class="line">skip_count=0</span><br><span class="line">work_count=0</span><br><span class="line"></span><br><span class="line">while read -r f; do</span><br><span class="line">    if [[ -n `echo &quot;$f&quot; | grep utf8` || -f &quot;$&#123;f%%cue&#125;utf8.cue&quot; || -f &quot;$&#123;f%%.cue&#125; utf8.cue&quot; ]]; then</span><br><span class="line">        echo &quot;skiping $f&quot;</span><br><span class="line">        skip_count=$((skip_count+1))</span><br><span class="line">        continue</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    echo &quot;Processing $f...&quot;</span><br><span class="line">    iconv -f GBK -t utf8 -o &quot;$&#123;f%%cue&#125;utf8.cue&quot; &quot;$f&quot;</span><br><span class="line">    work_count=$((work_count+1))</span><br><span class="line">done &lt; &lt;(find ./ -name &apos;*.cue&apos;)</span><br><span class="line"></span><br><span class="line">echo &quot;done: skipped: $skip_count, Processed: $work_count.&quot;</span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/tsocks-usage/" itemprop="url">
                  使用tsocks让程序走socks代理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2017-02-08T22:07:43+08:00" content="2017-02-08">
              2017-02-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>很多时候，我们需要让联网程序走代理才能正常工作，但是命令行工具的代理设置通常比较麻烦，不像浏览器一样有一个设置界面，通常通过设置环境变量<code>HTTP_PROXY</code>来实现，有的工具通过配置文件或者命令行参数也可以实现。</p>
<p>但是这常见的多数是针对http代理的，而我们的特殊网络环境下使用socks5代理很常见的，而要走socks代理的话就更麻烦了。像有时候要从github clone项目的时候，git的socks代理就非常麻烦，在windows下可以用全局代理工具去实现，在Linux下也需要一个方便的全局代理的工具。</p>
<p>tsocks（transparent socks）就可以满足我们的需求，tsocks可以方便地配置针对目的ip的代理服务器，可以将http请求代理到socks服务器，有方便的开关控制。在Fedora下执行<code>sudo dnf install tsocks</code>就可以了，但是默认安装的没有将配置文件拷贝到<code>/etc/</code>目录下。需要手动拷贝一下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo cp /usr/share/doc/tsocks/tsocks.conf.complex.example /etc/tsocks.conf</span><br></pre></td></tr></table></figure>
<p>这样就可以了，可以在里面配置path和server的信息，配置项目都有说明吗，比较好懂。</p>
<p>使用的话，直接运行<code>tsocks</code>会启动一个走代理的shell，在这个shell里面运行的命令会根据配置文件的配置走socks代理了，<code>Ctrl+d</code>或者<code>exit</code>退出该shell就回到正常shell了。也可以直接在 tsocks 后面直接加要运行的命令， 如 <code>tsocks git clone git@github.com:***/**</code> 这样git就能走socks代理了。</p>
<p>常见的命令<code>tsocks show</code>查看当前shell是否有tsocks代理，<code>tsocks on|off</code>开关tsocks。</p>
<p>配合shadowsocks就可以实现几乎任意程序的自由上网了。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/jp-dramas-of-jan-2017/" itemprop="url">
                  日剧杂项
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2017-01-29T21:19:23+08:00" content="2017-01-29">
              2017-01-29
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <p>最近新开播了好几部日剧，前几天闲着追了三部，都是追主演去的，感觉都还可以，分别是木村和竹内结子姐姐主演的医疗剧《A Life~ 深爱的人》，松隆子女神和满岛光主演的音乐剧《四重奏》还有吉高由里子和荣仓奈奈主演的《东京白日梦女》。</p>
<p>这三部剧到现在都出了两集， 得益于强大的编剧坂元裕二大神主笔，《四重奏》虽然是音乐剧的基调，但是故事性似乎远超其他两部剧。《A Life》虽然卡司阵容突破天际，除了木拓和竹内两人多年后重新合作，还有像浅野忠信这样的大牌，及川光博、木村文乃这样的准一线做配角，这阵容强大到可怕，但是到现在为止，这部剧收获的评价并没有想想的那么好，或者说故事没有期待的那么吸引人，而《东京白日梦女》见仁见智，看惯了这类剧的人可能会觉得情节有些老套，而新看的人可能会觉得好多台词可以记笔记了。</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/jp-dramas-of-jan-2017/" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/map-capslock-to-esc/" itemprop="url">
                  Linux将CapsLock映射为额外的Escape
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2017-01-25T12:28:14+08:00" content="2017-01-25">
              2017-01-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <p>大写锁定键是一个没有什么用的按键，一般需要大写输入习惯使用 Shift加字母实现，很多时候一不小心开了大写锁定没有发现还会导致输入错误，所以我的机器的大写锁定都是映射到Esc键的，习惯了之后会发现这是一个非常有用的设置，顺手，能提高效率。</p>
<p>在windows下可以用软件写注册表实现，并且操作一次后就不需要管了，一直工作很好，但在我的Fedora上用之前的方法，一种是通过gnome-tweak-took的type分类里面有一个设置项可以设置capslock的功能，另一种方式是使用dconf-editor方式，设置 <code>org.gnome.desktop.input-sources xkb-options</code>的值为 <code>[&#39;caps:escape&#39;]</code>。这两种方式的底层实现应该是同一种方式，在升级到 Fedora 25之后，这种设置偶尔会失效，打开一次 gnome-tweak-tool就会正常一段时间，然后又失效了。<br>
          <div class="post-more-link text-center">
            <a class="btn" href="/map-capslock-to-esc/" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/fstab-mount-ntfs-with-permission/" itemprop="url">
                  fstab自动挂载ntfs分区并设置权限
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2017-01-14T10:09:36+08:00" content="2017-01-14">
              2017-01-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>由于是Windows和Fedora的双系统，在fedora下需要挂载Windows下的几个分区，如果每次手动挂载实在太麻烦，可以在fstab里面配置自动分区信息，这样可以在开机的时候自动挂载这些分区了。</p>
<p>最开始的时候，使用下面的几行配置：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/dev/sda2 /run/media/wuxu/Windows ntfs defaults 1 2</span><br><span class="line">/dev/sda2 /run/media/wuxu/bin ntfs defaults 1 2</span><br></pre></td></tr></table></figure>
<p>但是这样挂载的分区使用默认的权限，也就是用户和组都是root，权限则是777，这在很多时候比较麻烦，比如一个带可执行权限的文本文件。我是配置的在打开带执行权限的文本文件时询问是否执行，实际上在Windows分区下的文件我只需要读写就可以了，这时可以如下配置权限：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/dev/sda2 /run/media/wuxu/bin ntfs defaults,uid=1000,gid=1000,dmask=022,fmask=111 1 2</span><br></pre></td></tr></table></figure>
<p>其中uid和gid是你用户的id，可以通过<code>id -u</code>和<code>id -g</code>查看，dmask是目录权限掩码，注意是掩码而不是权限，真正的权限是 7减去掩码位，022对应的是755，即rwxr-xr-x。注意文件夹需要提供x权限才能进入。fmask是文件权限，配置为111取消可执行权限。</p>
<p>如上即可自动挂载并配置好Windows分区的权限了，也可以根据需要配置为其他权限。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/avatar.jpg" alt="wuxu" itemprop="image"/>
          <p class="site-author-name" itemprop="name">wuxu</p>
        </div>
        <p class="site-description motion-element" itemprop="description">Wu Xu的个人博客</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">170</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">24</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">148</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/wuxu92" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/wuxu92" target="_blank">
                  
                    <i class="fa fa-twitter"></i> Twitter
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/kiwidock" target="_blank">
                  
                    <i class="fa fa-weibo"></i> Weibo
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://douban.com/people/wuxu92" target="_blank">
                  
                    <i class="fa fa-douban"></i> Douban
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/wuxu92" target="_blank">
                  
                    <i class="fa fa-zhihu"></i> Zhihu
                  
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wuxu</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
